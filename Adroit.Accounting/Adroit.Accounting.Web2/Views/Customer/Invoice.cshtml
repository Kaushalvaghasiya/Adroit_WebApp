@model Adroit.Accounting.Model.ViewModel.SalesBillMasterViewModel
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="dv-list side-app">
    <!-- page-header -->
    <div class="row">
        <div class="col-md-12 col-lg-12">
            <div class="page-header">
                <ol class="breadcrumb breadcrumb-arrow">
                    <li><a href="#">Transaction</a></li>
                    <li><a href="#">Booking</a></li>
                    <li class="active"><span>Invoice</span></li>
                </ol>
                <div class="ml-auto">
                    <div class="input-group">
                        <a href="#" class="btn-underdevelopment btn btn-secondary text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Bookmark this page"><span><i class="fa fa-star"></i></span></a>
                        <a href="#" class="btn-underdevelopment btn btn-primary text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="lock"><span><i class="fa fa-lock"></i></span></a>
                        <a href="#" class="btn-add-new btn btn-warning text-white btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Add New" id="AddNew"><span><i class="fa fa-plus"></i></span></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End page-header -->
    <!-- row -->
    <div class="row">
        <div class="col-md-12 col-lg-12">
            <div class="card">
                <div class="card-header">
                </div>
                <div class="card-body pt-0">
                    <div class="table-responsive">
                        <table id="tblMain" class="table table-bordered key-buttons text-nowrap">
                            <thead>
                                <tr>
                                    <th class="border-bottom-0 text-center">Branch Bill #</th>
                                    <th class="border-bottom-0 text-center">Bill Date</th>
                                    <th class="border-bottom-0">Bill Party</th>
                                    <th class="border-bottom-0 text-center">GST #</th>
                                    <th class="border-bottom-0 text-right">Amount</th>
                                    <th class="border-bottom-0 text-center">City</th>
                                    <th class="border-bottom-0 text-center">Firm Bill #</th>
                                    <th class="border-bottom-0 text-center" style="width:80px!important;">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- row end -->
</div>
<div class="dv-detail side-app">
    <!-- page-header -->
    <div class="row">
        <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12">
            <div class="page-header">
                <ol class="breadcrumb breadcrumb-arrow">
                    <li><a href="#">Transaction</a></li>
                    <li><a href="#">Booking</a></li>
                    <li><a href="#">Invoice</a></li>
                    <li class="active"><span id="activeTabName">Add</span></li>
                </ol>
                <div class="ml-auto">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search E-Way Bill..." id="GoSearchQuery">
                        <span class="input-group-append mr-2">
                            <button class="btn btn-primary EWayBill-search" type="button" data-container="body" data-toggle="popover" data-popover-color="default" data-placement="top" title="Popover top">Search</button>
                        </span>
                        <a href="#" class="btn-save btn btn-primary text-white mr-2 btn-sm mode-hide" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Save"><span><i class="fa fa-save"></i></span></a>
                        <a href="#" class="btn-print btn btn-blue text-white mr-2 btn-sm mode-hide" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Print"><span><i class="fa fa-print"></i></span></a>
                        <a href="#" class="btn-delete btn btn-danger text-white mr-2 btn-sm mode-hide" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Cancel"><span><i class="fa fa-remove"></i></span></a>
                        <a href="#" class="btn-add-new btn btn-warning text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="New"><span><i class="fa fa-plus"></i></span></a>
                        <a href="#" class="btn-back btn btn-gray text-white btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Cancel" id="btnCancel"><span><i class="fa fa-arrow-left"></i></span></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End page-header -->
    <!-- row -->
    <div class="row">
        <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12">
            <div class="card">
                <div class="card-header">
                    <!--<h3 class="card-title">Add/Edit Product</h3>-->
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-horizontal">
                                <div class="row mb-1">
                                    <label for="SerialNumberOfBranch" class="col-md-1 form-label">
                                        Branch Bill#
                                    </label>
                                    <div class="col-md-2">
                                        <input type="text" class="form-control" id="SerialNumberOfBranch" placeholder="">
                                    </div>
                                    <label for="BillDate" class="col-md-1 form-label mb-1">
                                        Bill Date
                                    </label>
                                    <div class="col-md-2">
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <div class="input-group-text">
                                                    <i class="fa fa-calendar tx-16 lh-0 op-6"></i>
                                                </div>
                                            </div>
                                            <input class="form-control fc-datepicker" placeholder="MM/DD/YYYY" type="text" id="BillDate">
                                        </div>
                                    </div>
                                    <label for="LRBookingId" class="col-md-1 form-label">
                                        LR#
                                    </label>
                                    <div class="col-md-2">
                                        <div class="input-group" style="flex-wrap:nowrap;">
                                            <select class="form-control select2-show-search-clear" id="LRBookingId">
                                                <option></option>
                                                @{
                                                    if (Model.LRNumberList != null)
                                                    {
                                                        foreach (var o in Model.LRNumberList)
                                                        {
                                                            <option value="@o.Value">@o.Text</option>
                                                        }
                                                    }
                                                }
                                            </select>
                                            <span class="input-group-append">
                                                <button class="btn btn-primary" type="button" id="SearchLRNumber" style="height:38px;">Go!</button>
                                            </span>
                                        </div>
                                    </div>
                                    <label for="PayTypeId" class="col-md-1 form-label">
                                        Pay Type
                                    </label>
                                    <div class="col-md-2">
                                        <select class="form-control select2-show-search" id="PayTypeId">
                                            <option value="0" selected>All</option>
                                            @{
                                                if (Model.PayTypeList != null)
                                                {
                                                    foreach (var item in Model.PayTypeList)
                                                    {
                                                        <option value="@item.Value">@item.Text</option>
                                                    }
                                                }
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="AccountBranchMappingId" class="col-md-1 form-label">
                                        Bill Party
                                    </label>
                                    <div class="col-md-5">
                                        <select class="form-control select2-show-search" id="AccountBranchMappingId">
                                            <option></option>
                                            @{
                                                if (Model.AccountBranchMappingList != null)
                                                {
                                                    foreach (var o in Model.AccountBranchMappingList)
                                                    {
                                                        <option value="@o.Value">@o.Text</option>
                                                    }
                                                }
                                            }
                                        </select>
                                    </div>
                                    <label for="CreditDays" class="col-md-1 form-label">
                                        Credit Days
                                    </label>
                                    <div class="col-md-2">
                                        <input type="text" class="form-control" id="CreditDays" placeholder="">
                                    </div>
                                    <label for="LedgerAmount" class="col-md-1 form-label">
                                        Ledger Amount
                                    </label>
                                    <div class="col-md-2">
                                        <input type="text" class="form-control decimalonly" data-tofixed="2" id="LedgerAmount" placeholder="">
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="ChalanDateFrom" class="col-md-1 form-label mb-1">
                                        From Date
                                    </label>
                                    <div class="col-md-2">
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <div class="input-group-text">
                                                    <i class="fa fa-calendar tx-16 lh-0 op-6"></i>
                                                </div>
                                            </div>
                                            <input class="form-control fc-datepicker"
                                                   placeholder="MM/DD/YYYY" type="text" id="ChalanDateFrom">
                                        </div>
                                    </div>
                                    <div class="col-md-3 p-0">
                                        <div class="row">
                                            <label for="ChalanDateTo" class="col-md-4 form-label mb-1">
                                                To Date
                                            </label>
                                            <div class="col-md-6">
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <div class="input-group-text">
                                                            <i class="fa fa-calendar tx-16 lh-0 op-6"></i>
                                                        </div>
                                                    </div>
                                                    <input class="form-control fc-datepicker" placeholder="MM/DD/YYYY" type="text" id="ChalanDateTo">
                                                </div>
                                            </div>
                                            <div class="col-md-2" style="display:flex;">
                                                <a href="#" class="btn btn-primary" data-toggle="modal" id="LRNumberList" data-original-title="Select LR List">
                                                    <span>
                                                        <i class="fa fa-list"></i>
                                                    </span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <label for="VehicleNumber" class="col-md-1 form-label">
                                        Vehicle#
                                    </label>
                                    <div class="col-md-2">
                                        <select class="form-control select2-show-search" id="VehicleNumber">
                                            <option></option>
                                            @{
                                                if (Model.VehicleList != null)
                                                {
                                                    foreach (var o in Model.VehicleList)
                                                    {
                                                        <option value="@o.Text">@o.Text</option>
                                                    }
                                                }
                                            }
                                        </select>
                                    </div>
                                    <label for="BillNumber" class="col-md-1 form-label">
                                        Firm Bill#
                                    </label>
                                    <div class="col-md-2">
                                        <input type="text" class="form-control" id="BillNumber" placeholder="">
                                    </div>
                                </div>
                                <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12  p-0">
                                    <div class="card">
                                        <div class="card-header bg-primary" style="display:block">
                                            <!--header-->
                                            <div class="row mb-0">
                                                <div class="col-md-1">
                                                    <div class="row mb-0">
                                                        <div class="col-md-6">
                                                            <div class="form-group text-center mb-1">
                                                                <label for="LR#" class="font-weight-bold text-white">#</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group text-center mb-1">
                                                                <label for="LRBookingId" class="font-weight-bold text-white">LR#</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-1">
                                                    <div class="row mb-0">
                                                        <div class="col-md-6">
                                                            <div class="form-group text-center mb-1">
                                                                <label for="LRDate" class="font-weight-bold text-white">
                                                                    LR Dt.
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group text-center mb-1">
                                                                <label for="Packing" class="font-weight-bold text-white">Pkg</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-1">
                                                    <div class="row mb-0">
                                                        <div class="col-md-12">
                                                            <div class="form-group text-right mb-1">
                                                                <label for="ChargeWeight" class="font-weight-bold text-white">Ch.Wt.</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-1">
                                                    <div class="form-group text-right mb-1">
                                                        <label for="GST" class="font-weight-bold text-white">GST%</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-1">
                                                    <div class="form-group text-right mb-1">
                                                        <label for="NetAmount" class="font-weight-bold text-white">Net Amount</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-1 pl-0 pr-0">
                                                    <div class="form-group text-right mb-1">
                                                        <label for="exampleInputname" class="font-weight-bold text-white">
                                                            @Model.CustomerFirmTransportSetting.LRBookChargeLable1
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-md-1 pl-0 pr-0">
                                                    <div class="form-group text-right mb-1">
                                                        <label for="exampleInputname" class="font-weight-bold text-white">
                                                            @Model.CustomerFirmTransportSetting.LRBookChargeLable2
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-md-1 pl-0 pr-0">
                                                    <div class="form-group text-right mb-1">
                                                        <label for="exampleInputname" class="font-weight-bold text-white">
                                                            @Model.CustomerFirmTransportSetting.LRBookChargeLable3
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-md-1 pl-0 pr-0">
                                                    <div class="form-group text-right mb-1">
                                                        <label for="exampleInputname" class="font-weight-bold text-white">
                                                            @Model.CustomerFirmTransportSetting.LRBookChargeLable4
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-md-1 pl-0 pr-0">
                                                    <div class="form-group text-right mb-1">
                                                        <label for="exampleInputname" class="font-weight-bold text-white">
                                                            @Model.CustomerFirmTransportSetting.LRBookChargeLable5
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-md-1 pl-0 pr-0">
                                                    <div class="form-group text-right mb-1">
                                                        <label for="exampleInputname" class="font-weight-bold text-white">
                                                            @Model.CustomerFirmTransportSetting.LRBookChargeLable6
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-md-1">
                                                    <div class="form-group text-center mb-1">
                                                        <label for="Action" class="font-weight-bold text-white">Action</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body" style="max-height: 202px; overflow-x: hidden; pt-0">
                                            <div class="row">
                                                <div class="col-md-12" id="contentRow">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8 vertical-bottom">
                            <div class="form-horizontal">
                                <div class="row mb-2">
                                    <label for="PaymentDetail" class="col-md-2 form-label">
                                        Payment Detail
                                    </label>
                                    <div class="col-md-5">
                                        <input type="text" class="form-control" id="PaymentDetail" placeholder=" Under Developement" readonly tabindex="-1">
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <label for="Notes"
                                           class="col-md-2 form-label">Remarks</label>
                                    <div class="col-md-10">
                                        <textarea class="form-control" id="Notes" rows="3" placeholder="Write a large text here ..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-horizontal">
                                <div class="row mb-1">
                                    <label for="TaxableAmount" class="col-md-4 form-label text-left">Basic Amount</label>
                                    <div class="col-md-8">
                                        <input type="text" class="form-control text-right decimalonly" data-tofixed="2" id="TaxableAmount" placeholder="" readonly tabindex="-1">
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="TDSPercentage" class="col-md-2 form-label text-left">T.D.S.</label>
                                    <div class="col-md-2">
                                        <input type="text" class="form-control text-right decimalonly" data-tofixed="3" id="TDSPercentage" placeholder="%">
                                    </div>
                                    <div class="col-md-8">
                                        <input type="text" class="form-control text-right decimalonly" data-tofixed="2" id="TDSAmount" placeholder="">
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="SGSTTotal" class="col-md-4 form-label text-left">SGST</label>
                                    <div class="col-md-8">
                                        <input type="text" class="form-control text-right decimalonly" data-tofixed="2" id="SGSTTotal" placeholder="">
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="CGSTTotal" class="col-md-4 form-label text-left">CGST</label>
                                    <div class="col-md-8">
                                        <input type="text" class="form-control text-right decimalonly" data-tofixed="2" id="CGSTTotal" placeholder="">
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="IGSTTotal" class="col-md-4 form-label text-left">IGST</label>
                                    <div class="col-md-8">
                                        <input type="text" class="form-control text-right decimalonly" data-tofixed="2" id="IGSTTotal" placeholder="">
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="GSTStateCessTotal" class="col-md-4 form-label text-left">State Cess</label>
                                    <div class="col-md-8">
                                        <input type="text" class="form-control text-right decimalonly" data-tofixed="2" id="GSTStateCessTotal" placeholder="">
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="GSTCentralCessTotal" class="col-md-4 form-label text-left">Central Cess</label>
                                    <div class="col-md-8">
                                        <input type="text" class="form-control text-right decimalonly" data-tofixed="2" id="GSTCentralCessTotal" placeholder="">
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="TCSPercentage" class="col-md-2 form-label text-left">T.C.S.</label>
                                    <div class="col-md-2">
                                        <input type="text" class="form-control text-right decimalonly" data-tofixed="3" id="TCSPercentage" placeholder="%">
                                    </div>
                                    <div class="col-md-8">
                                        <input type="text" class="form-control text-right decimalonly" data-tofixed="2" id="TCSAmount" placeholder="">
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="RoundOff" class="col-md-4 form-label text-left">Other (+/-)</label>
                                    <div class="col-md-8">
                                        <input type="text" class="form-control text-right decimalonly" data-tofixed="2" id="RoundOff" placeholder="">
                                    </div>
                                </div>
                                <div class="row mb-1">
                                    <label for="BillAmount" class="col-md-4 form-label text-left">Bill Amount</label>
                                    <div class="col-md-8">
                                        <input type="text" class="form-control text-right decimalonly" data-tofixed="2" id="BillAmount" placeholder="" readonly tabindex="-1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-right">
                    <a href="#" class="btn-save btn btn-primary mt-1 mode-hide" data-toggle="tooltip" title="" data-placement="top" data-original-title="Save"><i class="fa fa-save"></i>&nbsp;Save</a>
                    <a href="#" class="btn-print btn btn-blue mt-1 mode-hide" title="" data-toggle="tooltip" data-placement="top" data-original-title="Print"><i class="fa fa-print"></i>&nbsp;Print</a>
                    <a href="#" class="btn-underdevelopment btn btn-success mt-1 mode-hide" data-toggle="tooltip" title="" data-placement="top" data-original-title="Send"><i class="fa fa-share-alt"></i>&nbsp;Send</a>
                    <a href="#" class="btn-delete btn btn-danger mt-1 mode-hide" data-toggle="tooltip" title="" data-placement="top" data-original-title="Cancel"><i class="fa fa-remove"></i>&nbsp;Cancel</a>
                    <a href="#" class="btn-add-new btn btn-warning mt-1" data-toggle="tooltip" title="" data-placement="top" data-original-title="Cancel"><i class="fa fa-plus"></i>&nbsp;New</a>
                    <a href="#" class="btn-back btn btn-gray mt-1" data-toggle="tooltip" title="" data-placement="top" data-original-title="Cancel"><i class="fa fa-arrow-left"></i>&nbsp;Cancel</a>
                </div>
            </div>
        </div>
    </div>
    <!-- row end -->
    <input type="hidden" id="Id" value="0" />

</div>
<!--LRListModal start-->
<div id="LRListModal" class="modal fade" data-backdrop="static" role="dialog"
     aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg m-5" role="document" style="min-width: -webkit-fill-available; min-height: -webkit-fill-available;">
        <div class="modal-content ">
            <div class="modal-header" style="justify-content: left !important;">
                <h5 class="modal-title col-md-1" style="align-self:center;">LR List</h5>
                <label for="LRFromDate" class="col-md-auto form-label mb-1 pt-2">
                    From Date
                </label>
                <div class="col-md-2">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <div class="input-group-text">
                                <i class="fa fa-calendar tx-16 lh-0 op-6"></i>
                            </div>
                        </div>
                        <input class="form-control fc-datepicker" placeholder="MM/DD/YYYY" type="text" id="LRFromDate">
                    </div>
                </div>
                <label for="LRToDate" class="col-md-auto form-label mb-1 pt-2">
                    To Date
                </label>
                <div class="col-md-2">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <div class="input-group-text">
                                <i class="fa fa-calendar tx-16 lh-0 op-6"></i>
                            </div>
                        </div>
                        <input class="form-control fc-datepicker" placeholder="MM/DD/YYYY" type="text" id="LRToDate">
                    </div>
                </div>
                <a href="#" class="btn btn-primary" data-toggle="modal" id="SearchLRNumberList" data-original-title="Select LR List">
                    Search
                </a>
            </div>
            <div class="modal-body pd-20">
                <div class="table-responsive">
                    <table id="LRtblMain" class="table table-bordered key-buttons text-nowrap">
                        <thead>
                            <tr>
                                <th class="border-bottom-0"><input type="checkbox" /></th>
                                <th class="border-bottom-0">LR#</th>
                                <th class="border-bottom-0">LR Date</th>
                                <th class="border-bottom-0">Pvt. Mark</th>
                                <th class="border-bottom-0">Consignor</th>
                                <th class="border-bottom-0">From City</th>
                                <th class="border-bottom-0">To City</th>
                                <th class="border-bottom-0">Net Amount</th>
                                <th class="border-bottom-0">GST%</th>
                                <th class="border-bottom-0">Vehicle No</th>
                                <th class="border-bottom-0">Consignee</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div><!-- modal-body -->
            <div class="modal-footer">
                <a href="#" type="button" class="btn btn-primary" id="AddData">Add</a>
                <a href="#" type="button" class="btn btn-secondary" data-dismiss="modal">Close</a>
            </div>
        </div>
    </div><!-- modal-dialog -->
</div><!-- modal -->
<!--LRListModal end-->
@section Scripts
{
    <script>

        var selectedLRDetails = [];
        var addedIds = [];
        var htmlContentArray = [];
        var contentRowId = 0;
        var payTypeIdTrigger = true;

        $(function (e) {

            $('.dv-list').show();
            $('.dv-detail').hide();

            bindDatatableList();

            $(".btn-delete").on("click", function () {
                cancelItemConfirmation($("#Id").val());
            });

            $("#ChalanDateFrom").on('change', function (e) {
                if ($(this).val() != '' || $(this).val() != null) {
                    $("#LRFromDate").val($(this).val());
                }
            });

            $("#ChalanDateTo").on('change', function (e) {
                if ($(this).val() != '' || $(this).val() != null) {
                    $("#LRToDate").val($(this).val());
                }
            });

            $("#LRNumberList").on('click', function (e) {

                if ($("#ChalanDateFrom").val() == "") {
                    showWarning("", "Please enter from date.");
                    $("#ChalanDateFrom").focus();
                    return false;
                }
                else if ($("#ChalanDateTo").val() == "") {
                    showWarning("", "Please enter to date.");
                    $("#ChalanDateTo").focus();
                    return false;
                }
                else {
                    if (bindLRList()) {
                        $("#LRListModal").modal("show");
                    }
                }

            });

            $("#SearchLRNumberList").on('click', function (e) {
                bindLRList();
            });

            $("#AddData").on('click', function (e) {
                $("#LRListModal").modal("hide");

                addRow();
            });

            $("#SearchLRNumber").on('click', function (e) {
                $("#AccountBranchMappingId").prop("disabled", false);

                if ($('#LRBookingId').val() == null || $('#LRBookingId').val() == '') {
                    showWarning("", "Please select LR Number.");
                } else {
                    getLRDetailListByLRNumber($('#LRBookingId').val());
                }

            });

            $("#LRBookingId").on("select2:unselecting", function (e) {
                $("#AccountBranchMappingId").prop("disabled", false);
                clearLRGrid();
            });

            $("#PayTypeId").on('change', function (e) {
                if (payTypeIdTrigger) {
                    bindBillParty();
                }
                payTypeIdTrigger = true;
            });

            $("#AccountBranchMappingId").on('change', function (e) {
                clearLRGrid();
                GetListByCustomerAccountBranchMappingId($(this).val());
                calculateBasicAmount();
            });

            $("#TaxableAmount").on('keyup', function (e) {
                calculateBasicAmount();
            });
            $("#SGSTTotal").on('keyup', function (e) {
                calculateBasicAmount();
            });
            $("#CGSTTotal").on('keyup', function (e) {
                calculateBasicAmount();
            });
            $("#IGSTTotal").on('keyup', function (e) {
                calculateBasicAmount();
            });
            $("#GSTStateCessTotal").on('keyup', function (e) {
                calculateBasicAmount();
            });
            $("#GSTCentralCessTotal").on('keyup', function (e) {
                calculateBasicAmount();
            });
            $("#TCSPercentage").on('keyup', function (e) {
                calculateBasicAmount();
            });
            $("#TCSAmount").on('keyup', function (e) {
                calculateBasicAmount();
            });

            $("#RoundOff").on('keyup', function (e) {
                calculateBasicAmount();
            });

            $("#TDSPercentage").on('keyup', function (e) {
                calculateTDS();
            });

            addClick();
        });

        function addClick() {
            $('.dv-list').slideUp();
            $('.dv-detail').slideDown();
            formReset();
            setScreenMode(false);
            $(".btn-delete").hide();
            $("#SerialNumberOfBranch").focus();
            $("#SerialNumberOfBranch").val(0);
            $("#BillNumber").val(0);
        }

        function viewMode(id) {
            getDetail(id, true);
        }

        function editMode(id) {
            getDetail(id, false);
        }

        function refreshDatatableList() {
            $('#tblMain').DataTable().ajax.reload();
        }

        function bindDatatableList() {
            let columns = [];
            let colDef = [];
            colDef.push({
                "render": function (data, type, row) {
                    return row.serialNumberOfBranch;
                },
                "targets": colDef.length,
                "className": "text-center",
            });
            colDef.push({
                "render": function (data, type, row) {
                    return moment(row.billDate.split('T')[0]).format('DD/MM/YYYY');
                },
                "targets": colDef.length,
                "className": "text-center",
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.billPartyName;
                },
                "targets": colDef.length,
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.gstNo;
                },
                "targets": colDef.length,
                "className": "text-center",
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.billAmount.toFixed(2);
                },
                "targets": colDef.length,
                "className": "text-right"
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.city;
                },
                "targets": colDef.length,
                "className": "text-center",
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.billNumber;
                },
                "targets": colDef.length,
                "className": "text-center",
            });
            colDef.push({
                "render": function (data, type, row) {
                    let btnAct = "<div class='btn-list'> ";
                    btnAct += "<a href='#' class='btn-edit btn btn-outline-warning small-icon-btn' data-value='" + row.id + "' data-toggle='tooltip' title='Edit' data-placement='bottom' data-original-title='Edit'><i class='fa fa-pencil'></i></a>&nbsp;&nbsp;";
                    btnAct += "<a href='#' class='btn-view btn btn-outline-info small-icon-btn' data-value='" + row.id + "' data-toggle='tooltip' title='View' data-placement='bottom' data-original-title='View'><i class='fa fa-info'></i></a>&nbsp;&nbsp;";
                    if (!row.deleted) {
                        btnAct += "<a href='#' class='btn-delete-grid btn btn-outline-danger small-icon-btn' data-value='" + row.id + "' data-toggle='tooltip' title='Delete' data-placement='bottom' data-original-title='Delete'><i class='fa fa-remove'></i></a>";
                    }

                    btnAct += "</div>";
                    return btnAct;
                },
                "targets": colDef.length,
                "className": "text-center",
                "orderable": false
            });

            columns.push({ "data": "serialNumberOfBranch", "name": "serialNumberOfBranch" });
            columns.push({ "data": "billDate", "name": "billDate" });
            columns.push({ "data": "billPartyName", "name": "billPartyName" });
            columns.push({ "data": "gstNo", "name": "gstNo" });
            columns.push({ "data": "billAmount", "name": "billAmount" });
            columns.push({ "data": "city", "name": "city" });
            columns.push({ "data": "billNumber", "name": "billNumber" });

            var table = $('#tblMain').DataTable({
                "bAutoWidth": false,
                lengthChange: false,
                ordering: true,
                searching: true,
                paging: true,
                pageLength: 50,
                order: [[0, 'asc']],
                pagingType: 'full_numbers',
                orderClasses: false,
                //scrollCollapse: true,
                //stateSave: false,
                columnDefs: colDef,
                columns: columns,
                language: {
                    paginate: {
                        next: '<i class="fa fa-angle-right"></i>', // or '→'
                        previous: '<i class="fa fa-angle-left"></i>', // or '←'
                        first: '<i class="fa fa-angle-double-left"></i>', // or '→'
                        last: '<i class="fa fa-angle-double-right"></i>' // or '←'
                    }
                },
                buttons: ['copy', 'excel', 'colvis'],
                processing: true,
                serverSide: true,
                ajax: {
                    url: '@(Url.Content("~/Customer/InvoiceList"))',
                    type: 'GET',
                    data: function (d) {
                    }
                },
                "initComplete": function (settings, json) {
                    gridInitComplete(table);
                },
                "drawCallback": function (settings) {
                    gridDrawCallback(this);
                },
                "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                    if (aData.deleted) {
                        $(nRow).addClass('cancelled-row');
                    }
                }
            });
        }

        function formReset() {
            $("#Id").val(0);
            $("#SerialNumberOfBranch").val(0);

            var formattedMinimumDate = $.datepicker.formatDate("dd/mm/yy", new Date());
            $("#BillDate").datepicker("setDate", formattedMinimumDate);

            var firstDate = new Date();
            firstDate.setDate(1);
            $("#ChalanDateFrom").datepicker("setDate", firstDate);
            $("#LRFromDate").datepicker("setDate", firstDate);

            var lastDate = new Date();
            lastDate.setMonth(lastDate.getMonth() + 1);
            lastDate.setDate(0);
            $("#ChalanDateTo").datepicker("setDate", lastDate);
            $("#LRToDate").datepicker("setDate", lastDate);

            $("#CreditDays").val('');
            $("#BillNumber").val(0);
            $("#Notes").val('');
            $("#TaxableAmount").val('');
            $("#TDSPercentage").val('');
            $("#TDSAmount").val('');
            $("#SGSTTotal").val('');
            $("#CGSTTotal").val('');
            $("#IGSTTotal").val('');
            $("#GSTStateCessTotal").val('');
            $("#GSTCentralCessTotal").val('');
            $("#RoundOff").val('');
            $("#BillAmount").val('');
            $("#TCSPercentage").val('');
            $("#TCSAmount").val('');
            $("#LRBookingId").val(null).trigger('change');
            $("#PayTypeId").val('0').trigger('change');
            $("#AccountBranchMappingId").val(null).trigger('change');
            $("#VehicleNumber").val(null).trigger('change');
            $("#contentRow").html('');

            $("#activeTabName").text("Add");
            $(".btn-delete").hide();
            $(".btn-print").hide();
        }

        function saveItem() {
            try {

                if ($("#BillDate").val() == "") {
                    showWarning("", "Please select bill date");
                    $("#BillDate").focus();
                    return false;
                }

                if ($("#AccountBranchMappingId").val() == null || $("#AccountBranchMappingId").val() == "") {
                    showWarning("", "Please select bill party");
                    $("#AccountBranchMappingId").focus();
                    return false;
                }

                if ($("#TaxableAmount").val() != null && $("#TaxableAmount").val() != "") {
                    if (!/^[-+]?(\d{1,8}(\.\d{0,2})?|\.\d{1,2})$/.test($("#TaxableAmount").val())) {
                        showWarning("", "Taxable amount must be up to 8 characters before the decimal point and 2 characters after the decimal point.");
                        $("#TaxableAmount").focus();
                        return false;
                    }
                }

                if ($("#TDSPercentage").val() != null && $("#TDSPercentage").val() != "") {
                    if (!/^[-+]?(\d{1,2}(\.\d{0,3})?|\.\d{1,3})$/.test($("#TDSPercentage").val())) {
                        showWarning("", "TDS percentage must be up to 2 characters before the decimal point and 3 characters after the decimal point.");
                        $("#TDSPercentage").focus();
                        return false;
                    }
                }

                if ($("#TDSAmount").val() != null && $("#TDSAmount").val() != "") {
                    if (!/^[-+]?(\d{1,8}(\.\d{0,2})?|\.\d{1,2})$/.test($("#TDSAmount").val())) {
                        showWarning("", "TDS amount must be up to 8 characters before the decimal point and 2 characters after the decimal point.");
                        $("#TDSAmount").focus();
                        return false;
                    }
                }

                if ($("#SGSTTotal").val() != null && $("#SGSTTotal").val() != "") {
                    if (!/^[-+]?(\d{1,8}(\.\d{0,2})?|\.\d{1,2})$/.test($("#SGSTTotal").val())) {
                        showWarning("", "SGST must be up to 8 characters before the decimal point and 2 characters after the decimal point.");
                        $("#SGSTTotal").focus();
                        return false;
                    }
                }

                if ($("#CGSTTotal").val() != null && $("#CGSTTotal").val() != "") {
                    if (!/^[-+]?(\d{1,8}(\.\d{0,2})?|\.\d{1,2})$/.test($("#CGSTTotal").val())) {
                        showWarning("", "CGST must be up to 8 characters before the decimal point and 2 characters after the decimal point.");
                        $("#CGSTTotal").focus();
                        return false;
                    }
                }

                if ($("#IGSTTotal").val() != null && $("#IGSTTotal").val() != "") {
                    if (!/^[-+]?(\d{1,8}(\.\d{0,2})?|\.\d{1,2})$/.test($("#IGSTTotal").val())) {
                        showWarning("", "IGST must be up to 8 characters before the decimal point and 2 characters after the decimal point.");
                        $("#IGSTTotal").focus();
                        return false;
                    }
                }

                if ($("#GSTStateCessTotal").val() != null && $("#GSTStateCessTotal").val() != "") {
                    if (!/^[-+]?(\d{1,8}(\.\d{0,2})?|\.\d{1,2})$/.test($("#GSTStateCessTotal").val())) {
                        showWarning("", "GSTStateCess must be up to 8 characters before the decimal point and 2 characters after the decimal point.");
                        $("#GSTStateCessTotal").focus();
                        return false;
                    }
                }

                if ($("#GSTCentralCessTotal").val() != null && $("#GSTCentralCessTotal").val() != "") {
                    if (!/^[-+]?(\d{1,8}(\.\d{0,2})?|\.\d{1,2})$/.test($("#GSTCentralCessTotal").val())) {
                        showWarning("", "GSTCentralCess must be up to 8 characters before the decimal point and 2 characters after the decimal point.");
                        $("#GSTCentralCessTotal").focus();
                        return false;
                    }
                }

                if ($("#TCSPercentage").val() != null && $("#TCSPercentage").val() != "") {
                    if (!/^[-+]?(\d{1,2}(\.\d{0,3})?|\.\d{1,3})$/.test($("#TCSPercentage").val())) {
                        showWarning("", "TCS percentage must be up to 2 characters before the decimal point and 3 characters after the decimal point.");
                        $("#TCSPercentage").focus();
                        return false;
                    }
                }

                if ($("#TCSAmount").val() != null && $("#TCSAmount").val() != "") {
                    if (!/^[-+]?(\d{1,8}(\.\d{0,2})?|\.\d{1,2})$/.test($("#TCSAmount").val())) {
                        showWarning("", "TCS amount must be up to 8 characters before the decimal point and 2 characters after the decimal point.");
                        $("#TCSAmount").focus();
                        return false;
                    }
                }

                if ($("#RoundOff").val() != null && $("#RoundOff").val() != "") {
                    if (!/^[-+]?(\d{1,2}(\.\d{0,2})?|\.\d{1,2})$/.test($("#RoundOff").val())) {
                        showWarning("", "RoundOff must be up to 2 characters before the decimal point and 2 characters after the decimal point.");
                        $("#RoundOff").focus();
                        return false;
                    }
                }

                if ($("#BillAmount").val() == null || $("#BillAmount").val() == "" || parseFloat($("#BillAmount").val()) == 0) {
                    showWarning("", "Invoice Value should be greater than 0.");
                    $("#BillAmount").focus();
                    return false;
                } else {
                    if (!/^[-+]?(\d{1,8}(\.\d{0,2})?|\.\d{1,2})$/.test($("#BillAmount").val())) {
                        showWarning("", "Invoice amount must be up to 8 characters before the decimal point and 2 characters after the decimal point.");
                        $("#BillAmount").focus();
                        return false;
                    }
                }

                var savedata = new Object();

                savedata.Id = parseInt($("#Id").val());

                savedata.SerialNumberOfBranch = getIntValueZero("SerialNumberOfBranch");
                savedata.BillDate = moment(getDate($("#BillDate").val())).format('YYYY-MM-DDTHH:mm:ss.SSS[Z]');
                savedata.ChalanDateFrom = getDate($("#ChalanDateFrom").val());
                savedata.ChalanDateTo = getDate($("#ChalanDateTo").val());
                savedata.CreditDays = getIntValueZero("CreditDays");
                savedata.BillNumber = getIntValueZero("BillNumber");
                savedata.Notes = $("#Notes").val();
                savedata.VehicleNumber = $("#VehicleNumber").val();
                savedata.AccountBranchMappingId = getIntValueZero("AccountBranchMappingId");
                savedata.DeliveryPartyAccountBranchMappingId = getIntValueZero("AccountBranchMappingId");
                savedata.TDSPercentage = getFloatValueZero("TDSPercentage", 2);
                savedata.TCSPercentage = getFloatValueZero("TCSPercentage", 2);
                savedata.TaxableAmount = getFloatValueZero("TaxableAmount", 2);
                savedata.TDSAmount = getFloatValueZero("TDSAmount", 2);
                savedata.SGSTTotal = getFloatValueZero("SGSTTotal", 2);
                savedata.CGSTTotal = getFloatValueZero("CGSTTotal", 2);
                savedata.IGSTTotal = getFloatValueZero("IGSTTotal", 2);
                savedata.GSTStateCessTotal = getFloatValueZero("GSTStateCessTotal", 2);
                savedata.GSTCentralCessTotal = getFloatValueZero("GSTCentralCessTotal", 2);
                savedata.RoundOff = getFloatValueZero("RoundOff", 2);
                savedata.BillAmount = getFloatValueZero("BillAmount", 2);
                savedata.TCSAmount = getFloatValueZero("TCSAmount", 2);
                savedata.HeaderBox5 = "0";
                savedata.SalesBillFromName = "Sales";
                savedata.EntryTypeName = "BKI";
                savedata.InvoiceMemo = false;

                savedata.LRDetailsArray = [];
                $('#contentRow .content-rows').each(function () {
                    var contentRowId = $(this).attr('id').replace(/\D/g, '');
                    var lrDetails = {};

                    lrDetails.LRBookingId = $('#hdnLRId' + contentRowId).val();

                    lrDetails.FreightAmount = parseFloat($('#NetAmount' + contentRowId).val()) || 0;
                    lrDetails.Charge1 = parseFloat($('#Charge1' + contentRowId).val()) || 0;
                    lrDetails.Charge2 = parseFloat($('#Charge2' + contentRowId).val()) || 0;
                    lrDetails.Charge3 = parseFloat($('#Charge3' + contentRowId).val()) || 0;
                    lrDetails.Charge4 = parseFloat($('#Charge4' + contentRowId).val()) || 0;
                    lrDetails.Charge5 = parseFloat($('#Charge5' + contentRowId).val()) || 0;
                    lrDetails.Charge6 = parseFloat($('#Charge6' + contentRowId).val()) || 0;
                    lrDetails.BasicAmount = parseFloat($('#BasicAmount' + contentRowId).val()) || 0;

                    lrDetails.SGSTPercentage = parseFloat($('#SGSTPercentage' + contentRowId).val()) || 0;
                    lrDetails.SGSTAmount = parseFloat($('#SGSTAmount' + contentRowId).val()) || 0;
                    lrDetails.CGSTPercentage = parseFloat($('#CGSTPercentage' + contentRowId).val()) || 0;
                    lrDetails.CGSTAmount = parseFloat($('#CGSTAmount' + contentRowId).val()) || 0;
                    lrDetails.IGSTPercentage = parseFloat($('#IGSTPercentage' + contentRowId).val()) || 0;
                    lrDetails.IGSTAmount = parseFloat($('#IGSTAmount' + contentRowId).val()) || 0;

                    lrDetails.GSTStateCessPercentage = parseFloat($('#GSTStateCessPercentage' + contentRowId).val()) || 0;
                    lrDetails.GSTStateCessAmount = parseFloat($('#GSTStateCessAmount' + contentRowId).val()) || 0;
                    lrDetails.GSTCentralCessPercentage = parseFloat($('#GSTCentralCessPercentage' + contentRowId).val()) || 0;
                    lrDetails.GSTCentralCessAmount = parseFloat($('#GSTCentralCessAmount' + contentRowId).val()) || 0;
                    lrDetails.GSTCentralCess = parseFloat($('#GSTCentralCess' + contentRowId).val()) || 0;

                    savedata.LRDetailsArray.push(lrDetails);
                });
                if (savedata.LRDetailsArray.length == 0) {
                    showWarning("", "Select minimum 1 LR.");
                    $("#BillAmount").focus();
                    return false;
                }

                blockUI('container');
                $.ajax({
                    type: "POST",
                    url: "@(Url.Action("SaveInvoice", "Customer"))",
                    data: JSON.stringify(savedata),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        unblockUI('container');
                        if (data.result == RESULT_SUCCESS) {
                            //formReset();
                            $("#Id").val(data.data);
                            showWarning("", 'Invoice saved successfully.');
                            refreshDatatableList();
                            $('.btn-delete').show();
                            $(".btn-print").show();
                        } else {
                            showError("", data.data);
                        }
                    },
                    error: function (error) {
                        unblockUI('container');
                        showError("", error.statusText);
                    }
                });

            }
            catch (e) {
                unblockUI('container');
                showError("", e.message);
            }

        }

        function deleteItem(id) {
            if (id == 0) {
                id = $('#Id').val();
            }
            try {
                blockUI('container');
                var retrundata = AjaxCall("Get", "@(Url.Content("~/Customer/DeleteInvoice"))" + "/" + id, "",
                    function (result) {
                        unblockUI('container');
                        var str = "";
                        try {
                            if (result.result == RESULT_SUCCESS) {
                                refreshDatatableList();
                                formReset();
                                $('.btn-back').click();
                            } else {
                                showError('Error', result.data); //warning,  success, error, info
                            }
                        } catch (e) {
                            showError('Error', e); //warning,  success, error, info
                        }
                    },
                    function (error) {
                        unblockUI('container');
                    });
            }
            catch (err) {
                unblockUI('container');
            }
        }

        function getDetail(id, isViewMode) {
            try {
                blockUI('container');
                var retrundata = AjaxCall("Get", "@(Url.Content("~/Customer/GetInvoice"))" + "/" + id, "",
                    function (result) {
                        unblockUI('container');
                        try {
                            if (result.result == RESULT_SUCCESS) {
                                payTypeIdTrigger = false;
                                addClick();
                                if (isViewMode) {
                                    setScreenMode(true);
                                    $("#activeTabName").text("VIEW ID# " + result.data.id);
                                } else {
                                    setScreenMode(false);
                                    $("#activeTabName").text("EDIT (ID# " + result.data.id + ")");
                                }
                                getLRDetailListBySalesBillMaster(result.data.id);

                                $("#Id").val(result.data.id);
                                $("#SerialNumberOfBranch").val(result.data.serialNumberOfBranch);
                                $("#BillDate").val(moment(result.data.billDate.split('T')[0]).format('DD/MM/YYYY'));
                                $("#CreditDays").val(result.data.creditDays);
                                $("#ChalanDateFrom").val(moment(result.data.chalanDateFrom.split('T')[0], 'YYYY-MM-DD').add(1, 'days').format('DD/MM/YYYY'));
                                $("#ChalanDateTo").val(moment(result.data.chalanDateTo.split('T')[0], 'YYYY-MM-DD').add(1, 'days').format('DD/MM/YYYY'));
                                $("#LRFromDate").val(moment(result.data.chalanDateFrom.split('T')[0], 'YYYY-MM-DD').add(1, 'days').format('DD/MM/YYYY'));
                                $("#LRToDate").val(moment(result.data.chalanDateTo.split('T')[0], 'YYYY-MM-DD').add(1, 'days').format('DD/MM/YYYY')); $("#BillNumber").val(result.data.billNumber);
                                $("#Notes").val(result.data.notes);
                                $("#TaxableAmount").val(result.data.taxableAmount ? result.data.taxableAmount.toFixed(2) : '');
                                $("#TDSPercentage").val(result.data.tdsPercentage ? result.data.tdsPercentage.toFixed(2) : '');
                                $("#TDSAmount").val(result.data.tdsAmount ? result.data.tdsAmount.toFixed(2) : '');
                                $("#SGSTTotal").val(result.data.sgstTotal ? result.data.sgstTotal.toFixed(2) : '');
                                $("#CGSTTotal").val(result.data.cgstTotal ? result.data.cgstTotal.toFixed(2) : '');
                                $("#IGSTTotal").val(result.data.igstTotal ? result.data.igstTotal.toFixed(2) : '');
                                $("#GSTStateCessTotal").val(result.data.gstStateCessTotal ? result.data.gstStateCessTotal.toFixed(2) : '');
                                $("#GSTCentralCessTotal").val(result.data.gstCentralCessTotal ? result.data.gstCentralCessTotal.toFixed(2) : '');
                                $("#RoundOff").val(result.data.roundOff ? result.data.roundOff.toFixed(2) : '');
                                $("#BillAmount").val(result.data.billAmount ? result.data.billAmount.toFixed(2) : '');
                                $("#TCSPercentage").val(result.data.tcsPercentage ? result.data.tcsPercentage.toFixed(3) : '');
                                $("#TCSAmount").val(result.data.tcsAmount ? result.data.tcsAmount.toFixed(2) : '');
                                $("#VehicleNumber").val(result.data.vehicleNumber).trigger('change');

                                $("#AccountBranchMappingId").empty();
                                $('#AccountBranchMappingId').append(new Option(result.data.billPartyName, result.data.accountBranchMappingId, false, false));
                                $('#AccountBranchMappingId').val(result.data.accountBranchMappingId).trigger('change');
                                payTypeIdTrigger = true;

                                if (result.data.deleted) {
                                    $('.btn-delete').hide();
                                }
                                else {
                                    $('.btn-delete').show();
                                }

                                $(".btn-print").show();

                            } else {
                                showError('Error', result.data); //warning,  success, error, info
                            }
                        } catch (e) {
                            unblockUI('container');
                            showError('Error', e); //warning,  success, error, info
                        }
                    },
                    function (error) {

                    });
            }
            catch (err) {
            }
        }

        function getLRDetailListBySalesBillMaster(salesBillMasterId) {
            try {
                blockUI('container');
                var retrundata = AjaxCall("Get", "@(Url.Content("~/Customer/GetListBySalesBillMasterId"))" + "/" + salesBillMasterId, "",
                    function (result) {
                        unblockUI('container');
                        try {
                            if (result.result == RESULT_SUCCESS) {

                                clearLRGrid()

                                result.data.forEach(function (row) {
                                    selectedLRDetails.push({
                                        lrBookingId: row.lrBookingId,
                                        lrNumber: row.lrNumber,
                                        lrDate: row.lrDateString,
                                        chargeWeight: parseFloat(row.chargeWeight || 0).toFixed(3),
                                        parcel: row.parcel,
                                        netAmount: parseFloat(row.freightAmount || 0).toFixed(2),
                                        charge1: parseFloat(row.charge1 || 0).toFixed(2),
                                        charge2: parseFloat(row.charge2 || 0).toFixed(2),
                                        charge3: parseFloat(row.charge3 || 0).toFixed(2),
                                        charge4: parseFloat(row.charge4 || 0).toFixed(2),
                                        charge5: parseFloat(row.charge5 || 0).toFixed(2),
                                        charge6: parseFloat(row.charge6 || 0).toFixed(2),

                                        gstRate: row.gstRate,
                                        gstCentralCess: row.gstCentralCessRate,
                                        gstStateCess: row.gstStateCessRate,

                                        sgstPercentage: row.sgstPercentage,
                                        sgstAmount: row.sgstAmount,
                                        cgstPercentage: row.cgstPercentage,
                                        cgstAmount: row.cgstAmount,
                                        igstPercentage: row.igstPercentage,
                                        igstAmount: row.igstAmount,

                                        gstStateCessPercentage: row.gstStateCessPercentage,
                                        gstStateCessAmount: row.gstStateCessAmount,
                                        gstCentralCessPercentage: row.gstCentralCessPercentage,
                                        gstCentralCessAmount: row.gstCentralCessAmount,
                                        gstCentralCess: row.gstCentralCess,
                                        gstInvoiceTypeId: row.gstInvoiceTypeId
                                    });
                                });

                                addRow();

                            } else {
                                showError('Error', result.data); //warning,  success, error, info
                            }
                        } catch (e) {
                            unblockUI('container');
                            showError('Error', e); //warning,  success, error, info
                        }
                    },
                    function (error) {

                    });
            }
            catch (err) {
            }
        }

        function GetListByCustomerAccountBranchMappingId(CustomerAccountBranchMappingId, contentRowId) {
            try {
                if ($("#AccountBranchMappingId").val() == '' || $("#AccountBranchMappingId").val() == null) return;
                var retrundata = AjaxCall("Get", "@(Url.Content("~/Customer/GetListByCustomerAccountBranchMappingId"))" + "/" + CustomerAccountBranchMappingId, "",
                    function (result) {
                        try {
                            if (result.result == RESULT_SUCCESS) {

                                $("#CreditDays").val(result.data.creditDays);
                                $("#TDSPercentage").val(result.data.tds);
                                $("#TCSPercentage").val(result.data.tcs);
                                calculateTDS();
                            } else {
                                showError('Error', result.data); //warning,  success, error, info
                            }
                        } catch (e) {
                            showError('Error', e); //warning,  success, error, info
                        }
                    },
                    function (error) {

                    });
            }
            catch (err) {
            }
        }

        function clearLRGrid() {
            selectedLRDetails = [];
            addedIds = [];
            $("#contentRow").html("");
            contentRowId = 0;
        }

        function getLRDetailListByLRNumber(lrNumberId) {
            try {
                blockUI('container');
                var retrundata = AjaxCall("Get", "@(Url.Content("~/Customer/GetInvoiceListByLRNumberId"))" + "/" + lrNumberId, "",
                    function (result) {
                        unblockUI('container');
                        try {
                            if (result.result == RESULT_SUCCESS) {
                                clearLRGrid();

                                result.data.forEach(function (row) {

                                    var isDuplicate = selectedLRDetails.some(item => item.id === row.id);

                                    $("#AccountBranchMappingId").val(row.billAccountBranchMappingId).trigger('change');
                                    $("#AccountBranchMappingId").select2({ disabled: 'true' });
                                    $("#CreditDays").val(row.creditDays);

                                    if (!isDuplicate) {
                                        selectedLRDetails.push({
                                            lrBookingId: row.id,
                                            lrNumber: row.lrNumber,
                                            lrDate: row.lrDateString,
                                            privateMarka: row.privateMarka,
                                            packing: row.packing,
                                            chargeWeight: parseFloat(row.chargeWeight || 0).toFixed(3),
                                            toCity: row.cityTo,
                                            fromCity: row.cityFrom,
                                            invoiceValue: parseFloat(row.invoiceValue || 0).toFixed(2),
                                            description: row.description,
                                            consignor: row.consignor,
                                            consignee: row.consignee,
                                            billPartyName: row.billPartyName,
                                            ewayBillNo: row.ewayBillNo,
                                            parcel: row.parcel,
                                            netAmount: parseFloat(row.netAmount || 0).toFixed(2),
                                            charge1: 0.00,
                                            charge2: 0.00,
                                            charge3: 0.00,
                                            charge4: 0.00,
                                            charge5: 0.00,
                                            charge6: 0.00,
                                            billAccountBranchMappingId: row.billAccountBranchMappingId,
                                            creditDays: row.creditDays,
                                            gstRate: row.gstRate,
                                            gstCentralCess: row.gstCentralCess,
                                            gstStateCess: row.gstStateCess,
                                            sgstPercentage: row.sgstPercentage,
                                            sgstAmount: row.sgstAmount,
                                            cgstPercentage: row.cgstPercentage,
                                            cgstAmount: row.cgstAmount,
                                            igstPercentage: row.igstPercentage,
                                            igstAmount: row.igstAmount,
                                            gstStateCessPercentage: row.gstStateCessPercentage,
                                            gstStateCessAmount: row.gstStateCessAmount,
                                            gstCentralCessPercentage: row.gstCentralCessPercentage,
                                            gstCentralCessAmount: row.gstCentralCessAmount,
                                            gstCentralCess: row.gstCentralCess,
                                            gstInvoiceTypeId: row.gstInvoiceTypeId
                                        });

                                    }
                                });

                                addRow();

                            } else {
                                showError('Error', result.data); //warning,  success, error, info
                            }
                        } catch (e) {
                            unblockUI('container');
                            showError('Error', e); //warning,  success, error, info
                        }
                    },
                    function (error) {

                    });
            }
            catch (err) {
            }
        }

        function bindLRList() {
            if ($('#LRFromDate').val() == '' || $('#LRFromDate').val() == null) {
                showWarning("", "Please select fromdate.");
                return false;
            }
            if ($('#LRToDate').val() == '' || $('#LRToDate').val() == null) {
                showWarning("", "Please select todate.");
                return false;
            }
            if ($('#PayTypeId').val() == '' || $('#PayTypeId').val() == null) {
                showWarning("", "Please select pay type.");
                return false;
            }
            if ($('#AccountBranchMappingId').val() == '' || $('#AccountBranchMappingId').val() == null) {
                showWarning("", "Please select bill party.");
                return false;
            }

            clearLRGrid();

            let columns = [];
            let colDef = [];

            colDef.push({
                "render": function (data, type, row) {
                    return '<input type="checkbox"/>';
                },
                "targets": 0,
                "orderable": false,
                'checkboxes': {
                    'selectRow': true
                }
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.lrNumber;
                },
                "targets": colDef.length,
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.lrDateString;
                },
                "targets": colDef.length,
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.privateMarka;
                },
                "targets": colDef.length,
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.consignor;
                },
                "targets": colDef.length,
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.cityFrom;
                },
                "targets": colDef.length,
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.cityTo;
                },
                "targets": colDef.length,
            });
            colDef.push({
                "render": function (data, type, row) {
                    return parseFloat(row.netAmount || 0).toFixed(2);
                },
                "targets": colDef.length,
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.rate;
                },
                "targets": colDef.length,
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.vehilcleNo;
                },
                "targets": colDef.length,
            });
            colDef.push({
                "render": function (data, type, row) {
                    return row.consignee;
                },
                "targets": colDef.length,
            });

            columns.push({ "data": "id", "name": "id" });
            columns.push({ "data": "lrNumber", "name": "lrNumber" });
            columns.push({ "data": "lrDate", "name": "lrDate" });
            columns.push({ "data": "privateMarka", "name": "privateMarka" });
            columns.push({ "data": "consignor", "name": "consignor" });
            columns.push({ "data": "cityFrom", "name": "cityFrom" });
            columns.push({ "data": "cityTo", "name": "cityTo" });
            columns.push({ "data": "netAmount", "name": "netAmount" });
            columns.push({ "data": "rate", "name": "rate" });
            columns.push({ "data": "vehilcleNo", "name": "vehilcleNo" });
            columns.push({ "data": "consignee", "name": "consignee" });

            var table = $('#LRtblMain').DataTable({
                "bAutoWidth": false,
                lengthChange: false,
                ordering: true,
                searching: false,
                paging: false,
                pageLength: 1,
                order: [[0, 'asc']],
                "destroy": true,
                // pagingType: 'full_numbers',
                orderClasses: false,
                scrollCollapse: true,
                //stateSave: false,
                columnDefs: colDef,
                columns: columns,
                buttons: ['copy', 'excel', 'colvis'],
                processing: true,
                serverSide: true,
                'select': {
                    'style': 'multi'
                },
                ajax: {
                    url: '@(Url.Content("~/Customer/GetLRBookingListByDate"))' + "/" + $('#LRFromDate').val().split('/').reverse().join('-') + "/" + $('#LRToDate').val().split('/').reverse().join('-') + "/" + $('#PayTypeId').val() + "/" + $('#AccountBranchMappingId').val(),
                    type: 'GET',
                    data: function (d) { }
                },
                "initComplete": function (settings, json) {
                    gridInitComplete(table);
                    if (selectedLRDetails.length == 0) {
                        $('#LRtblMain input[type="checkbox"]').prop('checked', true);

                        selectedIds = table.rows({ selected: true }).data().toArray().map(row => row.id);

                        table.rows({ selected: true }).data().each(function (row) {

                            var isDuplicate = selectedLRDetails.some(item => item.id === row.id);

                            if (!isDuplicate) {
                                selectedLRDetails.push({
                                    lrBookingId: row.id,
                                    lrNumber: row.lrNumber,
                                    lrDate: row.lrDateString,
                                    privateMarka: row.privateMarka,
                                    packing: row.packing,
                                    chargeWeight: parseFloat(row.chargeWeight || 0).toFixed(3),
                                    toCity: row.cityTo,
                                    fromCity: row.cityFrom,
                                    invoiceValue: parseFloat(row.invoiceValue || 0).toFixed(2),
                                    description: row.description,
                                    consignor: row.consignor,
                                    consignee: row.consignee,
                                    billPartyName: row.billPartyName,
                                    ewayBillNo: row.ewayBillNo,
                                    parcel: row.parcel,
                                    netAmount: parseFloat(row.netAmount || 0).toFixed(2),
                                    charge1: 0.00,
                                    charge2: 0.00,
                                    charge3: 0.00,
                                    charge4: 0.00,
                                    charge5: 0.00,
                                    charge6: 0.00,
                                    billAccountBranchMappingId: row.billAccountBranchMappingId,
                                    creditDays: row.creditDays,
                                    gstRate: row.gstRate,
                                    gstCentralCess: row.gstCentralCess,
                                    gstStateCess: row.gstStateCess,
                                    sgstPercentage: row.sgstPercentage,
                                    sgstAmount: row.sgstAmount,
                                    cgstPercentage: row.cgstPercentage,
                                    cgstAmount: row.cgstAmount,
                                    igstPercentage: row.igstPercentage,
                                    igstAmount: row.igstAmount,
                                    gstStateCessPercentage: row.gstStateCessPercentage,
                                    gstStateCessAmount: row.gstStateCessAmount,
                                    gstCentralCessPercentage: row.gstCentralCessPercentage,
                                    gstCentralCessAmount: row.gstCentralCessAmount,
                                    gstCentralCess: row.gstCentralCess,
                                    gstInvoiceTypeId: row.gstInvoiceTypeId
                                });
                            }
                        });

                        updateHiddenInput(selectedIds);
                    }

                    selectedLRDetails.forEach(function (item) {
                        var row = table.row(function (idx, data, node) {
                            return data.id === item.id;
                        });

                        if (row && row.length > 0) {
                            $(row.node()).find('input[type="checkbox"]').prop('checked', true);
                            $(row.node()).addClass('selected');
                        }
                    });
                },
                "drawCallback": function (settings) {
                    gridDrawCallback(this);
                },
                "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                    if (aData.deleted) {
                        $(nRow).addClass('cancelled-row');
                    }
                }
            });

            $('#LRtblMain thead input[type="checkbox"]').on('click', function () {
                var isChecked = this.checked;

                $('#LRtblMain tbody input[type="checkbox"]').prop('checked', isChecked);

                if (isChecked) {
                    var selectedRowsData = table.rows({ selected: true }).data().toArray();
                    selectedIds = selectedRowsData.map(row => row.id);
                    selectedLRDetails = selectedRowsData.map(row => ({
                        lrBookingId: row.lrBookingId,
                        lrNumber: row.lrNumber,
                        lrDate: row.lrDateString,
                        privateMarka: row.privateMarka,
                        packing: row.packing,
                        chargeWeight: parseFloat(row.chargeWeight || 0).toFixed(3),
                        toCity: row.cityTo,
                        fromCity: row.cityFrom,
                        description: row.description,
                        consignor: row.consignor,
                        consignee: row.consignee,
                        billPartyName: row.billPartyName,
                        parcel: row.parcel,
                        netAmount: parseFloat(row.netAmount || 0).toFixed(2),
                        charge1: 0.00,
                        charge2: 0.00,
                        charge3: 0.00,
                        charge4: 0.00,
                        charge5: 0.00,
                        charge6: 0.00,
                        gstRate: row.gstRate,
                        gstCentralCess: row.gstCentralCess,
                        gstStateCess: row.gstStateCess,
                        sgstPercentage: row.sgstPercentage,
                        sgstAmount: row.sgstAmount,
                        cgstPercentage: row.cgstPercentage,
                        cgstAmount: row.cgstAmount,
                        igstPercentage: row.igstPercentage,
                        igstAmount: row.igstAmount,
                        gstStateCessPercentage: row.gstStateCessPercentage,
                        gstStateCessAmount: row.gstStateCessAmount,
                        gstCentralCessPercentage: row.gstCentralCessPercentage,
                        gstCentralCessAmount: row.gstCentralCessAmount,
                        gstCentralCess: row.gstCentralCess,
                        gstInvoiceTypeId: row.gstInvoiceTypeId
                    }));
                } else {
                    selectedIds = [];
                    selectedLRDetails = [];
                }

                updateHiddenInput(selectedIds);
            });

            var selectedIds = [];
            $('#LRtblMain tbody').on('click', 'input[type="checkbox"]', function () {
                var tr = $(this).closest('tr');
                var row = table.row(tr);

                if (row && row.data() && row.data().id) {
                    if ($(this).prop('checked')) {
                        if (!selectedIds.includes(row.data().id)) {
                            selectedIds.push(row.data().id);

                            var isDuplicate = selectedLRDetails.some(item => item.id === row.data().id);

                            if (!isDuplicate) {
                                selectedLRDetails.push({
                                    lrBookingId: row.data().lrBookingId,
                                    lrNumber: row.data().lrNumber,
                                    lrDate: row.data().lrDateString,
                                    privateMarka: row.data().privateMarka,
                                    packing: row.data().packing,
                                    chargeWeight: parseFloat(row.data().chargeWeight || 0).toFixed(3),
                                    toCity: row.cityTo,
                                    fromCity: row.cityFrom,
                                    description: row.data().description,
                                    consignor: row.data().consignor,
                                    consignee: row.data().consignee,
                                    billPartyName: row.data().billPartyName,
                                    parcel: row.parcel,
                                    netAmount: parseFloat(row.data().netAmount || 0).toFixed(2),
                                    charge1: 0.00,
                                    charge2: 0.00,
                                    charge3: 0.00,
                                    charge4: 0.00,
                                    charge5: 0.00,
                                    charge6: 0.00,
                                    gstRate: row.data().gstRate,
                                    gstCentralCess: row.data().gstCentralCess,
                                    gstStateCess: row.data().gstStateCess,
                                    sgstPercentage: row.data().sgstPercentage,
                                    sgstAmount: row.data().sgstAmount,
                                    cgstPercentage: row.data().cgstPercentage,
                                    cgstAmount: row.data().cgstAmount,
                                    igstPercentage: row.data().igstPercentage,
                                    igstAmount: row.data().igstAmount,
                                    gstStateCessPercentage: row.data().gstStateCessPercentage,
                                    gstStateCessAmount: row.data().gstStateCessAmount,
                                    gstCentralCessPercentage: row.data().gstCentralCessPercentage,
                                    gstCentralCessAmount: row.data().gstCentralCessAmount,
                                    gstCentralCess: row.data().gstCentralCess,
                                    gstInvoiceTypeId: row.data().gstInvoiceTypeId
                                });
                            }
                        }
                    } else {
                        selectedIds = selectedIds.filter(item => item !== row.data().id);
                        selectedLRDetails = selectedLRDetails.filter(item => item.id !== row.data().id);
                    }
                }
            });

            return true;
        }

        function addRow() {
            htmlContentArray = [];
            for (var i = 0; i < selectedLRDetails.length; i++) {

                var lrBooking = selectedLRDetails[i];

                if (addedIds.indexOf(lrBooking.lrBookingId) === -1) {
                    var charge1 = lrBooking.charge1 == 0 ? "" : lrBooking.charge1;
                    var charge2 = lrBooking.charge2 == 0 ? "" : lrBooking.charge2;
                    var charge3 = lrBooking.charge3 == 0 ? "" : lrBooking.charge3;
                    var charge4 = lrBooking.charge4 == 0 ? "" : lrBooking.charge4;
                    var charge5 = lrBooking.charge5 == 0 ? "" : lrBooking.charge5;
                    var charge6 = lrBooking.charge6 == 0 ? "" : lrBooking.charge6;

                    var htmlContent = '<div class="row mb-0 rounded content-rows" id="row-' + contentRowId + '">' +
                        '<div class="col-md-1">' +
                        '<div class="row mb-0">' +
                        '<div class="col-md-6 pl-0 pr-0">' +
                        '<div class="form-group text-center mb-1">' +
                        '<label>' + (i + 1) + '</label>' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-6 pl-0 pr-0">' +
                        '<div class="form-group text-center mb-1">' +
                        '<label for="lrNumber" id="lrNumber' + contentRowId + '">' + lrBooking.lrNumber + '</label>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-1">' +
                        '<div class="row mb-0">' +
                        '<div class="col-md-6 pl-0 pr-0">' +
                        '<div class="form-group text-center mb-1">' +
                        '<label for="LRDate" id="LRDate' + contentRowId + '">' + (lrBooking.lrDate || '') + '</label>' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-6 pl-0 pr-0">' +
                        '<div class="form-group text-center mb-1">' +
                        '<label for="Packing" id="Packing' + contentRowId + '">' + (lrBooking.parcel || '') + '</label>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-1">' +
                        '<div class="row mb-0">' +
                        '<div class="col-md-12 pl-0 pr-0">' +
                        '<div class="form-group text-right mb-1">' +
                        '<label for="ChargeWeight" id="ChargeWeight' + contentRowId + '">' + (lrBooking.chargeWeight) + '</label>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-1">' +
                        '<div class="form-group text-right mb-1">' +
                        '<label for="GSTRate">' + (lrBooking.gstRate) + '</label>' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-1">' +
                        '<div class="form-group text-right mb-1">' +
                        '<label for="NetAmount">' + (lrBooking.netAmount) + '</label>' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-1">' +
                        '<div class="form-group text-right mb-1">' +
                        ' <input type="text" class="form-control text-right charges-input decimalonly" data-tofixed="2"  data-contentRowId="' + contentRowId + '" id="Charge1' + contentRowId + '" placeholder="0.00" value="' + charge1 + '" data-min="' + charge1 + '">' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-1">' +
                        '<div class="form-group text-right mb-1">' +
                        ' <input type="text" class="form-control text-right charges-input decimalonly" data-tofixed="2"  data-contentRowId="' + contentRowId + '" id="Charge2' + contentRowId + '" placeholder="0.00" value="' + charge2 + '" data-min="' + charge2 + '">' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-1">' +
                        '<div class="form-group text-right mb-1">' +
                        ' <input type="text" class="form-control text-right charges-input decimalonly" data-tofixed="2"  data-contentRowId="' + contentRowId + '" id="Charge3' + contentRowId + '" placeholder="0.00" value="' + charge3 + '" data-min="' + charge3 + '">' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-1">' +
                        '<div class="form-group text-right mb-1">' +
                        ' <input type="text" class="form-control text-right charges-input decimalonly" data-tofixed="2"  data-contentRowId="' + contentRowId + '" id="Charge4' + contentRowId + '" placeholder="0.00" value="' + charge4 + '" data-min="' + charge4 + '">' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-1">' +
                        '<div class="form-group text-right mb-1">' +
                        ' <input type="text" class="form-control text-right charges-input decimalonly" data-tofixed="2"  data-contentRowId="' + contentRowId + '" id="Charge5' + contentRowId + '" placeholder="0.00" value="' + charge5 + '" data-min="' + charge5 + '">' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-1">' +
                        '<div class="form-group text-right mb-1">' +
                        '<input type="text" class="form-control text-right charges-input decimalonly" data-tofixed="2"  data-contentRowId="' + contentRowId + '" id="Charge6' + contentRowId + '" placeholder="0.00" value="' + charge6 + '" min="' + charge6 + '">' +
                        '<input type="hidden" id="hdnLRId' + contentRowId + '" value="' + lrBooking.lrBookingId + '" />' +
                        '<input type="hidden" id="BasicAmount' + contentRowId + '" value="' + lrBooking.basicAmount + '" />' +
                        '<input type="hidden" id="GSTRate' + contentRowId + '" value="' + lrBooking.gstRate + '" />' +
                        '<input type="hidden" id="NetAmount' + contentRowId + '" value="' + lrBooking.netAmount + '" />' +
                        '<input type="hidden" id="GstCentralCessRate' + contentRowId + '" value="' + lrBooking.gstCentralCessRate + '" />' +
                        '<input type="hidden" id="GstStateCessRate' + contentRowId + '" value="' + lrBooking.gstStateCessRate + '" />' +
                        '<input type="hidden" id="SGSTPercentage' + contentRowId + '" value="' + lrBooking.sgstPercentage + '" />' +
                        '<input type="hidden" id="SGSTAmount' + contentRowId + '" value="' + lrBooking.sgstAmount + '" />' +
                        '<input type="hidden" id="CGSTPercentage' + contentRowId + '" value="' + lrBooking.cgstPercentage + '" />' +
                        '<input type="hidden" id="CGSTAmount' + contentRowId + '" value="' + lrBooking.cgstAmount + '" />' +
                        '<input type="hidden" id="IGSTPercentage' + contentRowId + '" value="' + lrBooking.igstPercentage + '" />' +
                        '<input type="hidden" id="IGSTAmount' + contentRowId + '" value="' + lrBooking.igstAmount + '" />' +
                        '<input type="hidden" id="GSTStateCessPercentage' + contentRowId + '" value="' + lrBooking.gstStateCessPercentage + '" />' +
                        '<input type="hidden" id="GSTStateCessAmount' + contentRowId + '" value="' + lrBooking.gstStateCessAmount + '" />' +
                        '<input type="hidden" id="GSTCentralCessPercentage' + contentRowId + '" value="' + lrBooking.gstCentralCessPercentage + '" />' +
                        '<input type="hidden" id="GSTCentralCessAmount' + contentRowId + '" value="' + lrBooking.gstCentralCessAmount + '" />' +
                        '<input type="hidden" id="GSTCentralCess' + contentRowId + '" value="' + lrBooking.gstCentralCess + '" />' +
                        '<input type="hidden" id="GSTInvoiceTypeId' + contentRowId + '" value="' + lrBooking.gstInvoiceTypeId + '" />' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-1">' +
                        '<div class="form-group text-center mb-1">' +
                        '<a href="javascript:deleteRow(' + lrBooking.lrBookingId + ');" class="btn btn-outline-danger small-icon-btn" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Delete"><i class="fa fa-trash-o"></i></a>' +
                        '</div>' +
                        '</div><div class="col-md-12"><hr></div>' +
                        '</div>';

                    htmlContentArray.push(htmlContent);

                    addedIds.push(lrBooking.lrBookingId);
                    contentRowId++;

                }
            }

            $('.content-rows-add-btn').remove();
            $('#contentRow').append(htmlContentArray.join(''));
            $('.select2-show-search-contentrows').select2({
                minimumResultsForSearch: ''
            });

            $('.charges-input').on('keyup', function () {
                var inputField = $(this).attr('data-contentRowId');
                calculateTaxableAmount(inputField);
                calculateBasicAmount();
            });

            $('.charges-input').on('change', function () {
                var minValue = parseFloat($(this).attr('data-min'));
                var inputValue = $(this).val();

                if (isNaN(inputValue) || parseFloat(inputValue) < minValue) {
                    $(this).val(minValue);
                }
            });

            var counter = 0;
            $('.content-row-srno').each(function () {
                $(this).val(++counter);
            });

            $('.delete-row-btn').on('click', function () {
                var index = $(this).data('index');
                deleteRow(index);
            });
            calculateTaxableAmount();
            calculateBasicAmount();
            updateSelectedIdsInput();

            applyDecimal();
        }

        function calculateTaxableAmount() {
            var CGSTTotal = 0;
            var SGSTTotal = 0;
            var IGSTTotal = 0;

            $('.content-rows').each(function () {
                var contentRowId = $(this).attr('id').replace('row-', '');
                var netAmount = parseFloat($('#NetAmount' + contentRowId).val()) || 0;
                var charge1 = parseFloat($('#Charge1' + contentRowId).val()) || 0;
                var charge2 = parseFloat($('#Charge2' + contentRowId).val()) || 0;
                var charge3 = parseFloat($('#Charge3' + contentRowId).val()) || 0;
                var charge4 = parseFloat($('#Charge4' + contentRowId).val()) || 0;
                var charge5 = parseFloat($('#Charge5' + contentRowId).val()) || 0;
                var charge6 = parseFloat($('#Charge6' + contentRowId).val()) || 0;

                var basicAmount = netAmount + charge1 + charge2 + charge3 + charge4 + charge5 + charge6;
                $('#BasicAmount' + contentRowId).val(basicAmount.toFixed(2));

                var gstRate = parseFloat($('#GSTRate' + contentRowId).val()) || 0;
                var gstAmount = basicAmount * gstRate / 100;

                if ($('#GSTInvoiceTypeId' + contentRowId).val() == '@((int)Adroit.Accounting.Model.Enums.GSTInvoiceType.Regular)') {
                    var gstRateHalf = gstRate / 2;
                    var gstAmountHalf = gstAmount / 2;
                    $('#SGSTPercentage' + contentRowId).val(gstRateHalf);
                    $('#SGSTAmount' + contentRowId).val(gstAmountHalf);
                    $('#CGSTPercentage' + contentRowId).val(gstRateHalf);
                    $('#CGSTAmount' + contentRowId).val(gstAmountHalf);

                    $('#IGSTPercentage' + contentRowId).val(0);
                    $('#IGSTAmount' + contentRowId).val(0);

                    CGSTTotal += gstAmountHalf;
                    SGSTTotal += gstAmountHalf;

                }
                else {
                    $('#IGSTPercentage' + contentRowId).val(gstRate);
                    $('#IGSTAmount' + contentRowId).val(gstAmount);

                    $('#SGSTPercentage' + contentRowId).val(0);
                    $('#SGSTAmount' + contentRowId).val(0);
                    $('#CGSTPercentage' + contentRowId).val(0);
                    $('#CGSTAmount' + contentRowId).val(0);
                    IGSTTotal += gstAmount;
                }

                //0 for now.
                $('#GSTStateCessPercentage' + contentRowId).val(0.00);
                $('#GSTStateCessAmount' + contentRowId).val(0.00);
                $('#GSTCentralCessPercentage' + contentRowId).val(0.00);
                $('#GSTCentralCessAmount' + contentRowId).val(0.00);
                $('#GSTCentralCess' + contentRowId).val(0.00);

                // '<input type="hidden" id="GSTRate' + contentRowId + '" value="' + lrBooking.gstRate + '" />' +
                // '<input type="hidden" id="GstCentralCessRate' + contentRowId + '" value="' + lrBooking.gstCentralCessRate + '" />' +
                // '<input type="hidden" id="GstStateCessRate' + contentRowId + '" value="' + lrBooking.gstStateCessRate + '" />' +
                // '<input type="hidden" id="SGSTPercentage' + contentRowId + '" value="' + lrBooking.sgstPercentage + '" />' +
                // '<input type="hidden" id="SGSTAmount' + contentRowId + '" value="' + lrBooking.sgstAmount + '" />' +
                // '<input type="hidden" id="CGSTPercentage' + contentRowId + '" value="' + lrBooking.cgstPercentage + '" />' +
                // '<input type="hidden" id="CGSTAmount' + contentRowId + '" value="' + lrBooking.cgstAmount + '" />' +
                // '<input type="hidden" id="IGSTPercentage' + contentRowId + '" value="' + lrBooking.igstPercentage + '" />' +
                // '<input type="hidden" id="IGSTAmount' + contentRowId + '" value="' + lrBooking.igstAmount + '" />' +
                // '<input type="hidden" id="GSTStateCessPercentage' + contentRowId + '" value="' + lrBooking.gstStateCessPercentage + '" />' +
                // '<input type="hidden" id="GSTStateCessAmount' + contentRowId + '" value="' + lrBooking.gstStateCessAmount + '" />' +
                // '<input type="hidden" id="GSTCentralCessPercentage' + contentRowId + '" value="' + lrBooking.gstCentralCessPercentage + '" />' +
                // '<input type="hidden" id="GSTCentralCessAmount' + contentRowId + '" value="' + lrBooking.gstCentralCessAmount + '" />' +
                // '<input type="hidden" id="GSTCentralCess' + contentRowId + '" value="' + lrBooking.gstCentralCess + '" />' +
                // '<input type="hidden" id="GSTInvoiceTypeId' + contentRowId + '" value="' + lrBooking.gstInvoiceTypeId + '" />' +

            });

            $('#CGSTTotal').val(CGSTTotal.toFixed(2));
            $('#SGSTTotal').val(SGSTTotal.toFixed(2));
            $('#IGSTTotal').val(IGSTTotal.toFixed(2));

            $('#GSTStateCessTotal').val(0.00);
            $('#GSTCentralCessTotal').val(0.00);
        }

        function calculateBasicAmount() {
            var totalBasicAmount = 0;

            $('.content-rows').each(function () {
                var contentRowId = $(this).attr('id').replace('row-', '');
                var basicAmount = parseFloat($('#BasicAmount' + contentRowId).val()) || 0;
                totalBasicAmount += basicAmount;
            });

            $('#TaxableAmount').val(totalBasicAmount.toFixed(2));
            calculateTDS();

            var BasicAmount = parseFloat($('#TaxableAmount').val()) || 0;
            var CGSTTotal = parseFloat($('#CGSTTotal').val()) || 0;
            var SGSTTotal = parseFloat($('#SGSTTotal').val()) || 0;
            var IGSTTotal = parseFloat($('#IGSTTotal').val()) || 0;
            var GSTStateCessTotal = parseFloat($('#GSTStateCessTotal').val()) || 0;
            var GSTCentralCessTotal = parseFloat($('#GSTCentralCessTotal').val()) || 0;
            var TCSPercentage = parseFloat($('#TCSPercentage').val()) || 0;

            $('#TCSAmount').val(((BasicAmount + CGSTTotal + SGSTTotal + IGSTTotal + GSTStateCessTotal + GSTCentralCessTotal) * (TCSPercentage) / 100).toFixed(2));
            var TCSAmount = parseFloat($('#TCSAmount').val()) || 0;

            var totalAmount = BasicAmount + CGSTTotal + SGSTTotal + IGSTTotal + GSTStateCessTotal + GSTCentralCessTotal + TCSAmount;

            var RoundOff = customRound(totalAmount) - totalAmount;

            $('#RoundOff').val(RoundOff.toFixed(2));
            $('#BillAmount').val((BasicAmount + CGSTTotal + SGSTTotal + IGSTTotal + GSTStateCessTotal + GSTCentralCessTotal + TCSAmount + RoundOff).toFixed(2));

        }

        function deleteRow(lrBookingId) {
            var index = selectedLRDetails.findIndex(item => item.lrBookingId === lrBookingId);

            if (index !== -1) {
                $('#row-' + index).remove();
                addedIds = addedIds.filter(id => id !== lrBookingId);
                selectedLRDetails.splice(index, 1);

                calculateBasicAmount();
                updateSelectedIdsInput();

                // Update the id attribute for each remaining row
                // $('.content-rows').each(function (newIndex) {
                //     $(this).attr('id', 'row-' + newIndex);
                // });
            }

        }

        function updateSelectedIdsInput() {
            var uniqueIds = [...new Set(selectedLRDetails.map(item => item.id))];
            updateHiddenInput(uniqueIds);
            $("#ToPayAmount, #Paid, #TBB, #Total").val('0.00');
        }

        function updateHiddenInput(ids) {
            var uniqueIds = [...new Set(ids)];
            $('#hdnSelectedLRNumberIds').val(uniqueIds.join(','));
        }

        function bindBillParty() {
            try {
                $("#AccountBranchMappingId").empty();
                if ($('#PayTypeId').val() == '' || $('#PayTypeId').val() == null) {
                    showWarning("", "Please select pay type.");
                    return;
                }

                blockUI('container');
                var retrundata = AjaxCall("GET", "@(Url.Content("~/Customer/GetInvoiceCustomerAccountBranchMappingList_Select"))" + "/" + $('#PayTypeId').val(), "",
                    function (data) {
                        unblockUI('container');
                        if (data.result == RESULT_SUCCESS) {
                            $("#AccountBranchMappingId").empty();
                            if (data.data.length > 0) {
                                for (var i = 0; i < data.data.length; i++) {
                                    $('#AccountBranchMappingId').append(new Option(data.data[i].text, data.data[i].value, false, false));
                                }
                            }
                            $('#AccountBranchMappingId').val(null).trigger('change');
                        } else {
                            showError("", data.data);
                        }
                    },
                    function (error) {
                        unblockUI('container');
                        showError("", error.statusText);
                    });
            }
            catch (err) {
                unblockUI('container');
                showError("", e.message);
            }
        }

        function calculateTDS() {
            var taxableAmount = parseFloat($('#TaxableAmount').val()) || 0;
            var tdsPercentage = parseFloat($('#TDSPercentage').val()) || 0;
            $("#TDSAmount").val(Math.round(taxableAmount * tdsPercentage / 100));
        }
    </script>
}