@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="dv-list side-app">
    <!-- page-header -->
    <div class="row">
        <div class="col-md-12 col-lg-12">
            <div class="page-header">
                <ol class="breadcrumb breadcrumb-arrow">
                    <li><a href="#">Master</a></li>
                    <li><a href="#">Adroit</a></li>
                    <li><a href="#">Software</a></li>
                    <li class="active"><span>Software Plan</span></li>
                </ol>
                <div class="ml-auto">
                    <div class="input-group">
                        <a href="#" onclick="showUnderDevMsg()" class="btn btn-secondary text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Bookmark this page">
                            <span>
                                <i class="fa fa-star"></i>
                            </span>
                        </a>
                        <a href="#" onclick="showUnderDevMsg()" class="btn btn-primary text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="lock">
                            <span>
                                <i class="fa fa-lock"></i>
                            </span>
                        </a>
                        <a href="javascript:void(0);" class="btn-add-new btn btn-warning text-white btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Add New" id="AddNew">
                            <span>
                                <i class="fa fa-plus"></i>
                            </span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End page-header -->
    <!-- row -->
    <div class="row">
        <div class="col-md-12 col-lg-12">
            <div class="card">
                <div class="card-header">
                </div>
                <div class="card-body pt-0">
                    <div class="table-responsive">
                        <table id="tblMain" class="table table-bordered key-buttons text-wrap">
                            <thead>
                                <tr>
                                    <th class="border-bottom-0">SOFTWARE NAME</th>
                                    <th class="border-bottom-0">SUB SOFTWARE NAME</th>
                                    <th class="border-bottom-0">CODE</th>
                                    <th class="border-bottom-0">BUSINESS</th>
                                    <th class="border-bottom-0">COST</th>
                                    <th class="border-bottom-0 text-center" style="width:120px!important;">Action</th>
                                </tr>
                            </thead>

                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- row end -->
</div>
<div class="dv-detail side-app">
    <!-- page-header -->
    <div class="row">
        <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12">
            <div class="page-header">
                <ol class="breadcrumb breadcrumb-arrow">
                    <li><a href="#">Master</a></li>
                     <li><a href="#">Adroit</a></li>
                    <li><a href="#">Software</a></li>
                    <li><a href="#" class="btn-back">Plans</a></li>
                    <li class="active"><span id="activeTabName"></span></li>
                </ol>
                <div class="ml-auto">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search Firm...">
                        <span class="input-group-append mr-2">
                            <button class="btn btn-primary" type="button">Go!</button>
                        </span>
                        <a href="javascript:void(0);" class="btn btn-primary text-white mr-2 btn-sm cls-a-disable" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Save" onclick="saveDetail()">
                            <span>
                                <i class="fa fa-save"></i>
                            </span>
                        </a>
                        <a href="#" onclick="showUnderDevMsg()" class="btn btn-blue text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Print">
                            <span>
                                <i class="fa fa-print"></i>
                            </span>
                        </a>
                        <a href="#" onclick="showUnderDevMsg()" class="btn btn-success text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Send">
                            <span>
                                <i class="fa fa-share-alt"></i>
                            </span>
                        </a>
                        <a href="#"  onclick="deletePlanEdit()" class="btn btn-danger text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Delete">
                            <span>
                                <i class="fa fa-trash-o"></i>
                            </span>
                        </a>
                        <a href="javascript:void(0);" class="btn-add-new btn btn-warning text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="New">
                            <span>
                                <i class="fa fa-plus"></i>
                            </span>
                        </a>
                        <a href="#" class="btn-back btn btn-gray text-white btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Cancel" id="btnCancel">
                            <span>
                                <i class="fa fa-arrow-left"></i>
                            </span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End page-header -->
    <!-- row -->
    <div class="row">
        <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12">
            <div class="card">
                <div class="card-header">
                    <!--<h3 class="card-title">Add/Edit Product</h3>-->
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12 col-lg-6">
                            <div class="form-group">
                                <label for="SoftwareName">Software Name</label>
                                <div class="col-md-12 pl-2">
                                    <select class="form-control select2-show-search cls-disable" id="SoftwareName">
                                    </select>
                                </div>
                            </div>
                        </div>
                            <div class="col-lg-6 col-md-12">
                                    <div class="form-group">
                                        <label for="SubSoftwareName">Sub Software Name</label>
                                        <div class="col-md-12">
                                                <input type="text" class="form-control cls-disable" id="SubSoftwareName" maxlength="100" placeholder="Sub Software Name">
                                        </div>
                                    </div>
                            </div>
                                    
                    </div>
                    <div class="row">
                        <div class="col-md-12 col-lg-6">
                            <div class="form-group">
                                <label for="Code">Code</label>
                                <div class="col-md-12">
                                        <input type="text" class="form-control cls-disable" id="Code" placeholder="Code" maxlength="5">
                                    </div>
                            </div>
                        </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="form-group">
                                    <label for="Business">Business</label>
                                    <div class="col-md-12 pl-2">
                                       <input type="text" class="form-control cls-disable" id="Business" placeholder="Business" maxlength="20"> 
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 col-lg-6">
                                    <div class="form-group">
                                        <label for="Cost">Cost</label>
                                        <div class="col-md-12">
                                                <input type="text" class="form-control cls-disable" id="Cost" placeholder="Cost">
                                        </div>
                                    </div>
                            </div>
                           
                                </div>
                            </div>
                        </div>
                <div class="card-footer text-right">
                    <a href="javascript:void(0);" class="btn btn-primary mt-1 cls-a-disable" data-toggle="tooltip" title="" data-placement="top" data-original-title="Save" onclick="saveDetail()"><i class="fa fa-save"></i>&nbsp;Save</a>
                    <a href="#" onclick="showUnderDevMsg()" class="btn btn-blue mt-1" data-toggle="tooltip" title="" data-placement="top" data-original-title="Print"><i class="fa fa-print"></i>&nbsp;Print</a>
                    <a href="#" onclick="showUnderDevMsg()" class="btn btn-success mt-1" data-toggle="tooltip" title="" data-placement="top" data-original-title="Send"><i class="fa fa-share-alt"></i>&nbsp;Send</a>
                    <a href="#" onclick="deletePlanEdit()" class="btn btn-danger mt-1" data-toggle="tooltip" title="" data-placement="top" data-original-title="Delete"><i class="fa fa-trash-o"></i>&nbsp;Delete</a>
                    <a href="javascript:void(0)" class="btn-add-new btn btn-warning mt-1" data-toggle="tooltip" title="" data-placement="top" data-original-title="Cancel" ><i class="fa fa-plus"></i>&nbsp;New</a>
                    <a href="javascript:void(0);" class="btn-back btn btn-gray mt-1" data-toggle="tooltip" title="" data-placement="top" data-original-title="Cancel"><i class="fa fa-arrow-left"></i>&nbsp;Cancel</a>
                </div>
            </div>
        </div>
   <!-- row end -->
    <input type="hidden" id="Id" value="0" />
</div>


@section Scripts
    {

<script>

    var RESULT_SUCCESS = "@Adroit.Accounting.Utility.Constant.API_RESULT_SUCCESS";

    $(function (e) {
          $('.dv-list').show();
          $('.dv-detail').hide();

          $('.btn-add-new').click(function () {
              $('.dv-list').slideUp();
              $('.dv-detail').slideDown();
              $(".btn-danger").hide();
                fromReset();
          });

          $('.btn-back').click(function () {
              $('.dv-detail').slideUp();
              $('.dv-list').slideDown();
          });

        datatablelist();
        bindSoftwareList();
      });

     function disableFieldView(id)
     {
        getDetail(id,true);

    }

    function EditMode(id){
        getDetail(id,false);
    }

    function refreshDatatableList() {
        $('#tblMain').DataTable().ajax.reload();
    }

     function datatablelist() {
       let columns = [];
       let colDef = [];
               colDef.push({
                  "render": function (data, type, row) {
                      return row.softwareName;
                  },
                  "targets": colDef.length,
                  "orderable": false
              });
              colDef.push({
                  "render": function (data, type, row) {
                      return row.title;
                  },
                  "targets": colDef.length,

              });
              colDef.push({
                  "render": function (data, type, row) {
                      return row.code;
                  },
                  "targets": colDef.length,

              });
              colDef.push({
                  "render": function (data, type, row) {
                      return row.business;
                  },
                  "targets": colDef.length,

              });
               colDef.push({
                  "render": function (data, type, row) {
                      return row.cost;
                  },
                  "targets": colDef.length,

              });
               colDef.push({
                  "render": function (data, type, row) {
                      let btnAct = "<div class='btn-list'> <a onclick='EditMode(" + row.id + ");' href='javascript:void(0);' class='btn btn-outline-warning small-icon-btn' data-toggle='tooltip' title='' data-placement='bottom' data-original-title='Edit'><i class='fa fa-pencil'></i></a>";
                          btnAct += " &nbsp;&nbsp; <a href='#'onclick='disableFieldView(" + row.id + ");' class='btn btn-outline-info small-icon-btn' data-toggle='customer firm' title='' data-placement='bottom' data-original-title='View'><i class='fa fa-info'></i></a>";
                          btnAct += " &nbsp;&nbsp; <a onclick='DeleteData(" + row.id + ");' href='javascript:void(0);' class='btn btn-outline-danger small-icon-btn' data-toggle='tooltip' title='' data-placement='bottom' data-original-title='Delete'><i class='fa fa-trash-o'></i></a></div>";
                      return btnAct;
                  },
                  "targets": colDef.length,
                  "className": "text-center",
                  "orderable": false
              });

            columns.push({ "data": "softwareName", "name": "softwareName" });
            columns.push({ "data": "title", "name": "title" });
            columns.push({ "data": "business", "name": "business" });
            columns.push({ "data": "code", "name": "code" });
            columns.push({ "data": "cost", "name": "cost" });
            columns.push({ "data": "Id", "name": "Id" });


            var table = $('#tblMain').DataTable({
                "bAutoWidth": false,
                lengthChange: false,
                ordering: true,
                searching: true,
                paging: true,
                pageLength: 50,
                order: [[0, 'asc']],
                pagingType: 'full_numbers',
                orderClasses: false,
                //scrollCollapse: true,
                //stateSave: false,
                columnDefs: colDef,
                columns: columns,
                language: {
                    paginate: {
                        next: '<i class="fa fa-angle-right"></i>', // or '→'
                        previous: '<i class="fa fa-angle-left"></i>', // or '←'
                        first: '<i class="fa fa-angle-double-left"></i>', // or '→'
                        last: '<i class="fa fa-angle-double-right"></i>' // or '←'
                    }
                },
                buttons: ['copy', 'excel', 'pdf', 'colvis'],
                processing: true,
                serverSide: true,
                  ajax: {
                      url: '@(Url.Content("~/Admin/SoftwarePlanList"))',
                      type: 'GET',
                      data: function (d) { }
                  },
                   "initComplete": function(settings, json) {
                    table.buttons().container().appendTo('#tblMain_wrapper .col-md-6:eq(0)');

                    $(".buttons-copy").removeClass("btn-primary");
                    $(".buttons-copy").addClass("btn-outline-primary");

                    $(".buttons-excel").removeClass("btn-primary");
                    $(".buttons-excel").addClass("btn-outline-primary");

                    $(".buttons-pdf").removeClass("btn-primary");
                    $(".buttons-pdf").addClass("btn-outline-primary");

                    $(".buttons-colvis").removeClass("btn-primary");
                    $(".buttons-colvis").removeClass("dropdown-toggle");
                    $(".buttons-colvis").addClass("btn-outline-primary sub-icon");

                    $(".buttons-copy").empty();
                    $(".buttons-copy").append('<i class="fa fa-copy" data-toggle="tooltip" title="Copy" data-original-title="fa fa-copy"></i>');

                    $(".buttons-excel").empty();
                    $(".buttons-excel").append('<i class="fa fa-file-excel-o" data-toggle="tooltip" title="Excel" data-original-title="fa fa-file-excel-o"></i>');

                    $(".buttons-pdf").empty();
                    $(".buttons-pdf").append('<i class="fa fa-file-pdf-o" data-toggle="tooltip" title="PDF" data-original-title="fa fa-file-pdf-oo"></i>');

                    $(".buttons-colvis").empty();
                    $(".buttons-colvis").append('<i class="fa fa-eye" data-toggle="tooltip" title="Column Visibility" data-original-title="fa fa-eye"></i>');
                },
                "drawCallback": function (settings) {
                }

              });
      }

     function fromReset()
     {
        $("#Id").val(0);
        $("#SoftwareName").select2().val('').trigger("change");
        $("#SubSoftwareName").val("");
        $("#Code").val("");
        $("#Business").val("");
        $("#Cost").val("");
        $("#activeTabName").text("Add Software");
        $(".cls-disable").each(function(index, element){
         $(this).prop('disabled', false);
        });
         $(".cls-a-disable").each(function(index, element){

            $(this).removeClass("anchordisabled");
        });
     }

     function saveDetail()
     {
         try {
                  if($("#SoftwareName").val()==""){
                         showWarning("", "select software Name.");
                         $("#SoftwareName").focus();
                         return false;
                  }
                  if($("#SubSoftwareName").val()==""){
                         showWarning("", "Entry software name.");
                         $("#SubSoftwareName").focus();
                         return false;
                  }
                  if($("#Code").val()==""){
                         showWarning("", "Entry code.");
                         $("#Code").focus();
                         return false;
                  }
                  if($("#Business").val()==""){
                         showWarning("", "Entry bussiness.");
                         $("#Business").focus();
                         return false;
                  }
                  if($("#Cost").val()==""){
                         showWarning("", "Entry code.");
                         $("#Cost").focus();
                         return false;
                  }
                
                  var savedata = new Object();
                    savedata.Id = parseInt($("#Id").val());
                    savedata.SoftwareId=$("#SoftwareName").val();
                    savedata.Title=$("#SubSoftwareName").val();
                    savedata.Business=$("#Business").val();
                    savedata.Code=$("#Code").val();
                    savedata.Cost=$("#Cost").val();
                  
                   blockUI('container');

                   $.ajax({
                     type: "POST",
                     url: "@(Url.Action("SaveSoftwarePlan", "Admin"))",
                     data: JSON.stringify(savedata),
                     contentType: "application/json; charset=utf-8",
                     dataType: "json",
                     async: true,
                     success: function (data) {
                          unblockUI('container');
                          if (data.result == RESULT_SUCCESS) {
                              fromReset();
                              showWarning("", 'Software type saved successfully.');
                              $("#Id").val(0);
                              refreshDatatableList();
                               $('.btn-back').click();
                          } else {
                              showError("", data.data);
                          }
                      },
                  error: function (error) {
                          unblockUI('container');
                          showError("", error.statusText);
                      }
                  });

        }
            catch (e) {
            unblockUI('container');
            showError("", e.message);
        }

     }

    function DeleteData(id) {
              if (id == 0) {
                  id = $('#Id').val();
              }
              try {
                  blockUI('container');
                  var retrundata = AjaxCall("Delete", "@(Url.Content("~/Admin/DeleteSoftwarePlan"))" + "/" + id, "",
                      function (result) {
                          unblockUI('container');
                          var str = "<option value=0></option>";
                          try {
                              if (result.result == RESULT_SUCCESS) {
                                refreshDatatableList();
                                fromReset();
                                $('.btn-back').click();
                              } else {
                                  showError('Error', result.data); //warning,  success, error, info
                              }
                          } catch (e) {
                              showError('Error', e); //warning,  success, error, info
                          }
                      },
                      function (error) {
                          unblockUI('container');
                      });
              }
              catch (err) {
                  unblockUI('container');
              }
          }

    function getDetail(id,isViewMode) 
    {
              try {
                   blockUI('container');
                  var retrundata = AjaxCall("Get", "@(Url.Content("~/Admin/GetSoftwarePlan"))" + "/" + id, "",
                      function (result) {
                          unblockUI('container');
                          var str = "";
                          try {
                              if (result.result == RESULT_SUCCESS) 
                              {
                                           @* $("#AddNew").click(); *@
                                            $(".btn-add-new").click();
                                                if(isViewMode){
                                                    displaymode();
                                                }else{
                                                    EditmodeEnable();
                                                }
                                           $("#activeTabName").text("Software plan EDT(ID# "+result.data.id+")");
                                            $("#SoftwareName").val(result.data.softwareId).trigger("change");
                                            $("#SubSoftwareName").val(result.data.title);
                                            $("#Code").val(result.data.code);
                                            $("#Business").val(result.data.business);
                                            $("#Cost").val(result.data.cost);
                                           $('#Id').val(result.data.id);
                                            $(".btn-danger").show();

                              } else {
                                  showError('Error', result.data); //warning,  success, error, info
                              }
                          } catch (e) {
                              unblockUI('container');
                              showError('Error', e); //warning,  success, error, info
                          }
                      },
                      function (error) {

                      });
              }
              catch (err) {
              }
          }

    function bindSoftwareList() {
                try {
                    blockUI('container');
                    var retrundata = AjaxCall("GET", "@(Url.Content("~/Common/GetSoftware"))", "",
                        function (data) {
                            unblockUI('container');
                            var str = "<option value=0></option>";
                            if (data.result == RESULT_SUCCESS) {
                                if (data.data.length > 0) {
                                    for (var i = 0; i < data.data.length; i++) {
                                        str += ("<option value='" + data.data[i]['id'] + "'>" + data.data[i]["title"] + "</option>");
                                    }
                                }
                                $("#SoftwareName").html(str);
                            } else {
                                showError("", data.data);
                            }
                        },
                        function (error) {
                            unblockUI('container');
                            showError("", error.statusText);
                        });
                }
                catch (err) {
                    unblockUI('container');
                    showError("", e.message);
                }
            }

        function showUnderDevMsg(){
            showInfo("","Under Development");
        }
        function deletePlanEdit(){
            if($('#Id').val()>0){
            DeleteData($('#Id').val());
            }else{
                showError('Error', "select plan for delete");
            }

        }
        function displaymode(){
            $(".cls-disable").each(function(index, element){
                $(this).prop('disabled', true);
            });

            $(".cls-a-disable").each(function(index, element){
                $(this).addClass("anchordisabled");
            });
        }
        function EditmodeEnable(){
            $(".cls-disable").each(function(index, element){
                 $(this).prop('disabled', false);
            })
            $(".cls-a-disable").each(function(index, element){
                $(this).removeClass("anchordisabled");
            })
        }
</script>

}
