@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="dv-list side-app">
    <!-- page-header -->
    <div class="row">
        <div class="col-md-12 col-lg-12">
            <div class="page-header">
                <ol class="breadcrumb breadcrumb-arrow">
                    <li><a href="#">Master</a></li>
                    <li><a href="#">Customer</a></li>
                    <li><a href="#">Customer Firm</a></li>
                    <li class="active"><span>Branches</span></li>
                </ol>
                <div class="ml-auto">
                    <div class="input-group">
                        <a href="#" class="btn btn-secondary text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Bookmark this page">
                            <span>
                                <i class="fa fa-star"></i>
                            </span>
                        </a>
                        <a href="lockscreen.html" class="btn btn-primary text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="lock">
                            <span>
                                <i class="fa fa-lock"></i>
                            </span>
                        </a>
                        <a href="javascript:void(0);" class="btn-add-new btn btn-warning text-white btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Add New" id="AddNew">
                            <span>
                                <i class="fa fa-plus"></i>
                            </span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End page-header -->
    <!-- row -->
    <div class="row">
        <div class="col-md-12 col-lg-12">
            <div class="card">
                <div class="card-header">
                </div>
                <div class="card-body pt-0">
                    <div class="table-responsive">
                        <table id="tblMain" class="table table-bordered key-buttons text-wrap">
                            <thead>
                                <tr>
                                    <th class="border-bottom-0">BRANCH NAME</th>
                                    <th class="border-bottom-0">FIRM NAME</th>
                                    <th class="border-bottom-0">TYPE</th>
                                    <th class="border-bottom-0">CODE</th>
                                    <th class="border-bottom-0">GST</th>
                                    <th class="border-bottom-0">CITY</th>
                                    <th class="border-bottom-0">CREATED ON</th>
                                    <th class="border-bottom-0">RENEWAL DATE</th>
                                    <th class="border-bottom-0 text-center" style="width:160px!important;">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- row end -->
</div>
<div class="dv-detail side-app">
    <!-- page-header -->
    <div class="row">
        <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12">
            <div class="page-header">
                <ol class="breadcrumb breadcrumb-arrow">
                    <li><a href="#">Master</a></li>
                    <li><a href="#">Customer</a></li>
                    <li><a href="#">CustomerFirm</a></li>
                    <li><a href="#">CustomerBranch</a></li>
                    <li class="active"><span id="activeTabName">Branches Add/Edit</span></li>
                </ol>
                <div class="ml-auto">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search GST Number...">
                        <span class="input-group-append mr-2">
                            <button class="btn btn-primary" type="button">Go!</button>
                        </span>
                        <a href="javascript:void(0);" class="btn btn-primary text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Save" onclick="saveDetail()">
                            <span>
                                <i class="fa fa-save"></i>
                            </span>
                        </a>
                        <a href="#" class="btn btn-blue text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Print">
                            <span>
                                <i class="fa fa-print"></i>
                            </span>
                        </a>
                        <a href="#" class="btn btn-success text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Send">
                            <span>
                                <i class="fa fa-share-alt"></i>
                            </span>
                        </a>
                        <a href="#" class="btn btn-danger text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Delete">
                            <span>
                                <i class="fa fa-trash-o"></i>
                            </span>
                        </a>
                        <a href="#" class="btn-add-new btn btn-warning text-white mr-2 btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="New">
                            <span>
                                <i class="fa fa-plus"></i>
                            </span>
                        </a>
                        <a href="#" class="btn-back btn btn-gray text-white btn-sm" data-toggle="tooltip" title="" data-placement="bottom" data-original-title="Cancel" id="btnCancel" onclick="fromReset()">
                            <span>
                                <i class="fa fa-arrow-left"></i>
                            </span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End page-header -->
    <!-- row -->
    <div class="row">
        <div class="col-lg-12 col-xl-12 col-md-12 col-sm-12">
            <div class="card">
                <div class="card-header">
                    <!--<h3 class="card-title">Add/Edit Product</h3>-->
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="exampleInputname">Branch Name</label>
                                <input type="text" class="form-control cls-disable" id="txtBranchName" placeholder="Branch name" maxlength="100">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="exampleInputname">Firm</label>
                                <select class="form-control select2-show-search cls-disable" id="dropFirm">
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="exampleInputname">Branch Type</label>
                                <select class="form-control select2-show-search cls-disable" id="dropBranchType">
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="exampleInputname">Print Title</label>
                                <input type="text" class="form-control cls-disable" id="txtPrintTitle" placeholder="Print title" maxlength="100">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="exampleInputname">Short Name</label>
                                <input type="text" class="form-control cls-disable" id="txtShortName" placeholder="Short Name" maxlength="10">
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="exampleInputname">GST Number</label>
                                <input type="text" class="form-control cls-disable" id="txtGSTNumber" placeholder="GST Number" maxlength="15">
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="exampleInputname">PAN</label>
                                <input type="text" class="form-control cls-disable" id="txtPAN" placeholder="PAN" maxlength="10">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="exampleInputname">Address Line 1</label>
                                <input type="text" class="form-control cls-disable" id="txtAddressLin1" placeholder="Address Line 1" maxlength="200">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="exampleInputname">Address Line 2</label>
                                <input type="text" class="form-control cls-disable" id="txtAddressLin2" placeholder="Address Line 2" maxlength="200">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="exampleInputname">Address Line 3</label>
                                <input type="text" class="form-control cls-disable" id="txtAddressLin3" placeholder="Address Line 3" maxlength="200">
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="exampleInputname">Country</label>
                                <select class="form-control select2-show-search cls-disable" id="dropCountry">
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="exampleInputname">State</label>
                                <select class="form-control select2-show-search cls-disable" id="dropState">
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="exampleInputname">City</label>
                                <select class="form-control select2-show-search cls-disable" id="dropCity">
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="exampleInputname">Pincode</label>
                                <input type="text" class="form-control cls-disable numberonly" id="txtPincode" placeholder="Pincode" maxlength="12">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="exampleInputname">Contact Person</label>
                                <input type="text" class="form-control cls-disable" id="txtContactPerson" placeholder="Contact Person" maxlength="30">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="exampleInputname">Phone</label>
                                <input type="text" class="form-control cls-disable" id="txtPhone" placeholder="Phone" maxlength="50">
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="exampleInputname">Mobile</label>
                                <input type="text" class="form-control numberonly cls-disable" id="txtMobile" placeholder="Mobile" maxlength="15">
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="exampleInputname">Alternate Mobile</label>
                                <input type="text" class="form-control cls-disable numberonly" id="txtAlternateMobile" placeholder="Alternate Mobile" maxlength="15">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="exampleInputname">Email</label>
                                <input type="text" class="form-control cls-disable" id="txtEmail" placeholder="Email" maxlength="50">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="exampleInputname">EWB Address Line 1</label>
                                <input type="text" class="form-control cls-disable" id="txtEWBAdressLine1" placeholder="EWB Address Line 1" maxlength="200">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="exampleInputname">EWB Address Line 2</label>
                                <input type="text" class="form-control cls-disable" id="txtEWBAdressLine2" placeholder="EWB Address Line 2" maxlength="200">
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="RenewalDate">Renewal Date</label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">
                                            <i class="fa fa-calendar tx-16 lh-0 op-6"></i>
                                        </div>
                                    </div>
                                    <input class="form-control cls-disable fc-datepicker" placeholder="MM/DD/YYYY" type="text" id="dtRenewalDate">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="exampleInputname">Renewal Price</label>
                                <input type="text" class="form-control cls-disable" id="txtRenewalPrice" placeholder="Renewal Price">
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="exampleInputname">Setup Price</label>
                                <input type="text" class="form-control cls-disable numberonly" id="txtSetupPrice" placeholder="Setup Price">
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="exampleInputname">Order Number</label>
                                <input type="text" class="form-control cls-disable numberonly" id="txtOrderNumber" placeholder="Order Number">
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div><label for="exampleInputname">Active</label></div>
                            <label class="custom-switch">
                                <input type="checkbox" name="custom-switch-checkbox" class="cls-disable custom-switch-input" id="chkActive">
                                <span class="custom-switch-indicator"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-right">
                    <a href="javascript:void(0);" class="btn btn-primary mt-1" data-toggle="tooltip" title="" data-placement="top" data-original-title="Save" onclick="saveDetail()"><i class="fa fa-save"></i>&nbsp;Save</a>
                    <a href="#" class="btn btn-blue mt-1" data-toggle="tooltip" title="" data-placement="top" data-original-title="Print"><i class="fa fa-print"></i>&nbsp;Print</a>
                    <a href="#" class="btn btn-success mt-1" data-toggle="tooltip" title="" data-placement="top" data-original-title="Send"><i class="fa fa-share-alt"></i>&nbsp;Send</a>
                    <a href="#" class="btn btn-danger mt-1" data-toggle="tooltip" title="" data-placement="top" data-original-title="Delete"><i class="fa fa-trash-o"></i>&nbsp;Delete</a>
                    <a href="#" class="btn-back btn btn-warning mt-1" data-toggle="tooltip" title="" data-placement="top" data-original-title="Cancel" onclick="fromReset()"><i class="fa fa-plus"></i>&nbsp;New</a>
                    <a href="#" class="btn-back btn btn-gray mt-1" data-toggle="tooltip" title="" data-placement="top" data-original-title="Cancel"><i class="fa fa-arrow-left"></i>&nbsp;Cancel</a>
                </div>
            </div>
        </div>
    </div>
    <!-- row end -->
    <input type="hidden" id="Id" value=0 />
    <input type="hidden" id="hdnCityId" value=0 />
    <input type="hidden" id="hdnStateId" value=0 />
</div>


@section Scripts
  {
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script>

      var RESULT_SUCCESS = "@Adroit.Accounting.Utility.Constant.API_RESULT_SUCCESS";
      var DateFormate = "@Adroit.Accounting.Utility.Constant.DateFormate";
     $(function (e) {
          window.customerfirmId=GetParameterValues('id')
         $('.dv-list').show();
         $('.dv-detail').hide();

         $('.btn-add-new').click(function () {
             $('.dv-list').slideUp();
             $('.dv-detail').slideDown();
         });

         $('.btn-back').click(function () {
             $('.dv-detail').slideUp();
             $('.dv-list').slideDown();
         });

         datatablelist();

          $("#dropState").on('change', function (e) {
                     let stateId = $(this).val();
                     if (stateId > 0) {
                         bindCityList(stateId);
                     }
           });

             $("#dropCountry").on('change', function (e) {
                     let countryId = $(this).val();
                     if (countryId > 0) {
                         bindStateList(countryId);
                     } else {
                         $("#dropCountry").focus();
                         showWarning("", "Please select Country.");
                     }
           });

        bindCountryList();
        bindBusinessTypeList();
        bindFirmList();
     });


      function disableFieldView(id){
        $(".cls-disable").each(function(index, element){

        $(this).prop('disabled', true)
        })
        getDetail(id);

    }
    function EditMode(id){
        $(".cls-disable").each(function(index, element){

        $(this).prop('disabled', false)
        })
        getDetail(id);
    }

     function refreshDatatableList() {
            $('#tblMain').DataTable().ajax.reload();
        }

    function GetParameterValues(param)
         {
                var url = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
                for (var i = 0; i < url.length; i++) {
                var urlparam = url[i].split('=');
                if (urlparam[0] == param) {
                return urlparam[1];
                            }
                    }
        }

    function datatablelist() {
      let columns = [];
      let colDef = [];
                colDef.push({
                 "render": function (data, type, row) {
                     return row.title;
                 },
                 "targets": colDef.length,
                  });
              colDef.push({
                 "render": function (data, type, row) {
                     return row.customerFirm;
                 },
                 "targets": colDef.length,
             });
             colDef.push({
                 "render": function (data, type, row) {
                     return row.firmBranchTypeAdmin;
                 },
                 "targets": colDef.length,
             });
             colDef.push({
                 "render": function (data, type, row) {
                     return row.pincode;
                 },
                 "targets": colDef.length,
             });
             colDef.push({
                 "render": function (data, type, row) {
                     return row.gstNumber;
                 },
                 "targets": colDef.length,
             });
             colDef.push({
                 "render": function (data, type, row) {
                     return row.city;
                 },
                 "targets": colDef.length,
             });
             colDef.push({
                 "render": function (data, type, row) {
                     return row.addedOnStr;
                 },
                 "targets": colDef.length,
             });
                colDef.push({
                 "render": function (data, type, row) {
                     return row.renewalDateStr;
                 },
                 "targets": colDef.length,
             });
              colDef.push({
                 "render": function (data, type, row) {
                     let btnAct = "<div class='btn-list'><a onclick='EditMode(" + row.id + ");' href='javascript:void(0);' class='btn btn-outline-warning small-icon-btn' data-toggle='tooltip' title='' data-placement='bottom' data-original-title='Edit'><i class='fa fa-pencil'></i></a>";
                     btnAct += " &nbsp;&nbsp; <a href='#'onclick='disableFieldView(" + row.id + ");' class='btn btn-outline-info small-icon-btn' data-toggle='customer firm' title='' data-placement='bottom' data-original-title='View'><i class='fa fa-info'></i></a>";
                     btnAct += " &nbsp;&nbsp; <a onclick='branchDelete(" + row.id + ");' href='javascript:void(0);' class='btn btn-outline-danger small-icon-btn' data-toggle='tooltip' title='' data-placement='bottom' data-original-title='Delete'><i class='fa fa-trash-o'></i></a><div>";
                     return btnAct;
                 },
                 "targets": colDef.length,
                 "className": "text-center",
                 "orderable": false
             });

             columns.push({ "data": "CustomerFirm", "name": "CustomerFirm" });
             columns.push({ "data": "FirmBranchTypeAdmin", "name": "FirmBranchTypeAdmin" });
             columns.push({ "data": "Title", "name": "Title" });
             columns.push({ "data": "GST", "name": "GST" });
             columns.push({ "data": "City", "name": "City" });
             columns.push({ "data": "AddedOn", "name": "AddedOn" });
             columns.push({ "data": "renewalDate", "name": "renewalDate" });
             columns.push({ "data": "Id", "name": "Id" });

              var table = $('#tblMain').DataTable({
                "bAutoWidth": false,
                lengthChange: false,
                ordering: true,
                searching: true,
                paging: true,
                pageLength: 50,
                order: [[0, 'asc']],
                pagingType: 'full_numbers',
                orderClasses: false,
                //scrollCollapse: true,
                //stateSave: false,
                columnDefs: colDef,
                columns: columns,
                language: {
                    paginate: {
                        next: '<i class="fa fa-angle-right"></i>', // or '→'
                        previous: '<i class="fa fa-angle-left"></i>', // or '←'
                        first: '<i class="fa fa-angle-double-left"></i>', // or '→'
                        last: '<i class="fa fa-angle-double-right"></i>' // or '←'
                    }
                },
                buttons: ['copy', 'excel', 'pdf', 'colvis'],
                processing: true,
                serverSide: true,
                 ajax: {
                     url: '@(Url.Content("~/Admin/CustomerFirmBranchList?firmId="))'+window.customerfirmId,
                     type: 'GET',
                     data: function (d) { }
                 },
                  "initComplete": function(settings, json) {
                    table.buttons().container().appendTo('#tblMain_wrapper .col-md-6:eq(0)');

                    $(".buttons-copy").removeClass("btn-primary");
                    $(".buttons-copy").addClass("btn-outline-primary");

                    $(".buttons-excel").removeClass("btn-primary");
                    $(".buttons-excel").addClass("btn-outline-primary");

                    $(".buttons-pdf").removeClass("btn-primary");
                    $(".buttons-pdf").addClass("btn-outline-primary");

                    $(".buttons-colvis").removeClass("btn-primary");
                    $(".buttons-colvis").removeClass("dropdown-toggle");
                    $(".buttons-colvis").addClass("btn-outline-primary sub-icon");

                    $(".buttons-copy").empty();
                    $(".buttons-copy").append('<i class="fa fa-copy" data-toggle="tooltip" title="Copy" data-original-title="fa fa-copy"></i>');

                    $(".buttons-excel").empty();
                    $(".buttons-excel").append('<i class="fa fa-file-excel-o" data-toggle="tooltip" title="Excel" data-original-title="fa fa-file-excel-o"></i>');

                    $(".buttons-pdf").empty();
                    $(".buttons-pdf").append('<i class="fa fa-file-pdf-o" data-toggle="tooltip" title="PDF" data-original-title="fa fa-file-pdf-oo"></i>');

                    $(".buttons-colvis").empty();
                    $(".buttons-colvis").append('<i class="fa fa-eye" data-toggle="tooltip" title="Column Visibility" data-original-title="fa fa-eye"></i>');
                },
                "drawCallback": function (settings) {
                }

             });
     }

    function bindCountryList() {
                 try {
                     blockUI('container');
                     var retrundata = AjaxCall("GET", "@(Url.Content("~/Common/GetCountries"))", "",
                         function (data) {
                             unblockUI('container');
                             var str = "<option></option>";
                             str += "<option value='0'>Select Country</option>";
                             if (data.result == RESULT_SUCCESS) {
                                 if (data.data.length > 0) {
                                     for (var i = 0; i < data.data.length; i++) {
                                         str += ("<option value='" + data.data[i]['id'] + "'>" + data.data[i]["title"] + "</option>");
                                     }
                                 }
                                 $("#dropCountry").html(str);
                             } else {
                                 showError("", data.data);
                             }
                         },
                         function (error) {
                             unblockUI('container');
                             showError("", error.statusText);
                         });
                 }
                 catch (err) {
                     unblockUI('container');
                     showError("", e.message);
                 }
             }
    function bindStateList(countryId) {
                 try {
                     blockUI('container');
                     var retrundata = AjaxCall("GET", "@(Url.Content("~/Common/GetStates"))" + "?countryId=" + countryId, "",
                         function (data) {
                             unblockUI('container');
                             var str = "<option></option>";
                             str += "<option value='0'>Select State</option>";
                             if (data.result == RESULT_SUCCESS) {
                                 if (data.data.length > 0) {
                                     for (var i = 0; i < data.data.length; i++) {
                                         str += ("<option value='" + data.data[i]['id'] + "'>" + data.data[i]["title"] + "</option>");
                                     }
                                 }
                                 $("#dropState").html(str);
                             } else {
                                 showError("", data.data);
                             }
                             if($("#hdnStateId").val()!=0){
                                   $("#dropState").select2().val($("#hdnStateId").val()).trigger("change");
                             }
                         },
                         function (error) {
                             unblockUI('container');
                             showError("", error.statusText);
                         });
                 }
                 catch (err) {
                     unblockUI('container');
                     showError("", e.message);
                 }
             }

    function bindCityList(stateId) {
                 try {
                     blockUI('container');
                     var retrundata = AjaxCall("GET", "@(Url.Content("~/Common/GetCities"))" + "?stateId=" + stateId, "",
                         function (data) {
                             unblockUI('container');
                           var str = "<option value='0'>Select City</option>";
                             if (data.result == RESULT_SUCCESS) {
                                 if (data.data.length > 0) {
                                     for (var i = 0; i < data.data.length; i++) {
                                         str += ("<option value='" + data.data[i]['id'] + "'>" + data.data[i]["title"] + "</option>");
                                     }
                                 }
                                 $("#dropCity").html(str);
                             } else {
                                 showError("", data.data);
                             }
                             if($("#hdnCityId").val()!=0){
                                   $("#dropCity").select2().val($("#hdnCityId").val()).trigger("change");
                             }
                         },
                         function (error) {
                             unblockUI('container');
                             showError("", error.statusText);
                         });
                 }
                 catch (err) {
                     unblockUI('container');
                     showError("", e.message);
                 }
             }

    function bindBusinessTypeList(stateId) {
                 try {
                     blockUI('container');
                     var retrundata = AjaxCall("GET", "@(Url.Content("~/Common/GetFirmBranchTypeAdmin"))", "",
                         function (data) {
                             unblockUI('container');
                             var str = "<option value='0'>Select business</option>";

                             if (data.result == RESULT_SUCCESS) {
                                 if (data.data.length > 0) {
                                     for (var i = 0; i < data.data.length; i++) {
                                         str += ("<option value='" + data.data[i]['id'] + "'>" + data.data[i]["title"] + "</option>");
                                     }
                                 }
                                 $("#dropBranchType").html(str);
                             } else {
                                 showError("", data.data);
                             }
                         },
                         function (error) {
                             unblockUI('container');
                             showError("", error.statusText);
                         });
                 }
                 catch (err) {
                     unblockUI('container');
                     showError("", e.message);
                 }
             }
    function bindFirmList() {
                 try {
                     blockUI('container');
                     var retrundata = AjaxCall("GET", "@(Url.Content("~/Common/GetFirm"))", "",
                         function (data) {
                             unblockUI('container');
                             var str = "<option value='0'>Select Firm</option>";
                             if (data.result == RESULT_SUCCESS) {
                                 if (data.data.length > 0) {
                                     for (var i = 0; i < data.data.length; i++) {
                                         str += ("<option value='" + data.data[i]['id'] + "'>" + data.data[i]["title"] + "</option>");
                                     }
                                 }
                                 $("#dropFirm").html(str);
                             } else {
                                 showError("", data.data);
                             }
                         },
                         function (error) {
                             unblockUI('container');
                             showError("", error.statusText);
                         });
                 }
                 catch (err) {
                     unblockUI('container');
                     showError("", e.message);
                  }
             }
    function fromReset()
    {
        $("#Id").val(0);
        $("#txtBranchName").val("");
        $("#dropFirm").select2().val('').trigger("change");
        $("#dropBranchType").select2().val('').trigger("change");
        $("#txtPrintTitle").val("");
        $("#txtShortName").val("");
        $("#txtGSTNumber").val("");
        $("#txtPAN").val("");
        $("#txtAddressLin1").val("");
        $("#txtAddressLin2").val("");
        $("#txtAddressLin3").val("");
        $("#dropCountry").select2().val('').trigger("change");
        $("#dropState").select2().val('').trigger("change");
        $("#dropCity").select2().val('').trigger("change");
        $("#txtPincode").val("");
        $("#txtContactPerson").val("");
        $("#txtPhone").val("");
        $("#txtMobile").val("");
        $("#txtAlternateMobile").val("");
        $("#txtEmail").val("");
        $("#txtEWBAdressLine1").val("");
        $("#txtEWBAdressLine2").val("");
        $("#dtRenewalDate").val("");
        $("#txtRenewalPrice").val("");
        $("#txtSetupPrice").val("");
        $("#txtOrderNumber").val("");
        $('.custom-switch-input').prop('checked', false);
        $("#activeTabName").text("Branch Add");
        $(".cls-disable").each(function(index, element){

        $(this).prop('disabled', false)
        })
     }

     function saveDetail() {
             try {

                 if($("#dropFirm").val()==0){
                        showWarning("", "Please Select Firm");
                        $("#dropFirm").focus();
                          $('.dv-list').slideUp();
                        return false;
                 }

                  if($("#txtBranchName").val()==""){
                        showWarning("", "Please entry branch name");
                        $("#txtBranchName").focus();
                          $('.dv-list').slideUp();
                        return false;
                 }

                 if($("#dropBranchType").val()==0){
                        showWarning("", "Please Select branch");
                        $("#dropBranchType").focus();
                          $('.dv-list').slideUp();
                        return false;
                 }
                if($("#dropCountry").val()==0){
                        showWarning("", "Please Select country");
                        $("#dropCountry").focus();
                          $('.dv-list').slideUp();
                        return false;
                 }
                 if($("#txtSetupPrice").val()==""){
                        showWarning("", "Please entry setup price");
                        $("#txtSetupPrice").focus();
                          $('.dv-list').slideUp();
                        return false;
                 }

                 if($("#txtRenewalPrice").val()==""){
                        showWarning("", "Please entry Renewal Price");
                        $("#txtRenewalPrice").focus();
                          $('.dv-list').slideUp();
                        return false;
                 }
                 if($("#dtRenewalDate").val()==""){
                        showWarning("", "Please entry Renewal Date");
                        $("#dtRenewalDate").focus();
                          $('.dv-list').slideUp();
                        return false;
                 }
                 if($("#txtEmail").val()!="")
                 {
                    let isValidemail = IsEmail($("#txtEmail").val());
                    if (!isValidemail) {
                        showWarning("", "Please enter valid email");
                        $("#txtEmail").focus();
                        return;
                    }
                 }
                 var orderNumber=0
                 if($("#txtOrderNumber").val()!=""){
                   orderNumber=parseInt($("#txtOrderNumber").val())
                 }
                 var savedata = new Object();
                  savedata.Id = parseInt($("#Id").val());
                  savedata.Title=$("#txtBranchName").val();
                  savedata.FirmId=parseInt($("#dropFirm").val());
                  savedata.FirmBranchTypeId=parseInt($("#dropBranchType").val());
                  savedata.PrintTitle=$("#txtPrintTitle").val();
                  savedata.ShortTitle=$("#txtShortName").val();
                  savedata.GSTNumber=$("#txtGSTNumber").val();
                  savedata.PAN=$("#txtPAN").val();
                  savedata.Address1=$("#txtAddressLin1").val();
                  savedata.Address2=$("#txtAddressLin2").val();
                  savedata.Address3=$("#txtAddressLin3").val();
                  savedata.CountryId=parseInt($("#dropCountry").val());
                  savedata.StateId=$("#dropState").val();
                  savedata.CityId=$("#dropCity").val();
                  savedata.Pincode=$("#txtPincode").val();
                  savedata.ContactPersonName=$("#txtContactPerson").val();
                  savedata.EWBAddress1=$("#txtEWBAdressLine1").val();
                  savedata.EWBAddress2=$("#txtEWBAdressLine2").val();
                  savedata.RenewalDate=new Date($("#dtRenewalDate").val());
                  savedata.RenewalPrice=$("#txtRenewalPrice").val();
                  savedata.SetupPrice=$("#txtSetupPrice").val();
                  savedata.OrderNumber=orderNumber;
                  savedata.Phone=$("#txtPhone").val();
                  savedata.Mobile=$("#txtMobile").val();
                  savedata.MobileAlternate=$("#txtMobileAlternate").val();
                  savedata.IsActive=$('#chkActive').is(':checked');
                  savedata.Email=$("#txtEmail").val()

                 blockUI('container');

                 $.ajax({
                 type: "POST",
                 url: "@(Url.Action("SaveCustomerFirmBranch", "Admin"))",
                 data: JSON.stringify(savedata),
                 contentType: "application/json; charset=utf-8",
                 dataType: "json",
                 success: function (data) {
                         unblockUI('container');
                         if (data.result == RESULT_SUCCESS) {
                             fromReset();
                             showWarning("", 'Customer saved successfully.');
                             $("#Id").val(0);
                             $('#tblMain').dataTable().fnClearTable();
                             $('#tblMain').dataTable().fnDestroy();
                             refreshDatatableList();
                             $("#btnCancel").click()
                         } else {
                             showError("", data.data);
                         }
                     },
                 error: function (error) {
                         unblockUI('container');
                         showError("", error.statusText);
                     }
                 });

             }
                 catch (e) {
                 unblockUI('container');
                 showError("", e.message);
             }

      }

    function branchDelete(id) {
             if (id == 0) {
                 id = $('#Id').val();
             }
             try {
                 blockUI('container');
                 var retrundata = AjaxCall("Delete", "@(Url.Content("~/Admin/DeleteCustomerFirmBranch"))" + "/" + id, "",
                     function (result) {
                         unblockUI('container');
                         var str = "";
                         try {
                             if (result.result == RESULT_SUCCESS) {
                                 $('#tblMain').dataTable().fnClearTable();
                                 $('#tblMain').dataTable().fnDestroy();
                                 refreshDatatableList();
                             } else {
                                 showError('Error', result.data); //warning,  success, error, info
                             }
                         } catch (e) {
                             showError('Error', e); //warning,  success, error, info
                         }
                     },
                     function (error) {
                         unblockUI('container');
                     });
             }
             catch (err) {
                 unblockUI('container');
             }
         }
    function redirect(id){
        var baseUrl= window.location.origin;
        window.open(baseUrl+"/admin/customerFirm?id="+id,'_blank').focus();
    }
    function getDetail(id) {
             try {
                  blockUI('container');
                 var retrundata = AjaxCall("Get", "@(Url.Content("~/Admin/GetCustomerFirmBranch"))" + "/" + id, "",
                     function (result) {
                         unblockUI('container');
                         var str = "";
                         try {
                             if (result.result == RESULT_SUCCESS) {
                                        $("#AddNew").click();
                                        $("#activeTabName").text("Branch EDT(ID# "+result.data.id+")");
                                        $("#Id").val(result.data.id);
                                        $("#txtBranchName").val(result.data.title);
                                        $("#dropFirm").select2().val(result.data.firmId).trigger("change");
                                        $("#dropBranchType").select2().val(result.data.firmBranchTypeId).trigger("change");
                                        $("#txtPrintTitle").val(result.data.printTitle);
                                        $("#txtShortName").val(result.data.shortTitle);
                                        $("#txtGSTNumber").val(result.data.gstNumber);
                                        $("#txtPAN").val(result.data.pan);
                                        $("#txtAddressLin1").val(result.data.address1);
                                        $("#txtAddressLin2").val(result.data.address2);
                                        $("#txtAddressLin3").val(result.data.address3);
                                        $("#dropCountry").select2().val(result.data.countryId).trigger("change");
                                        $("#hdnCityId").val(result.data.cityId)
                                        $("#hdnStateId").val(result.data.stateId)
                                        $("#txtPincode").val(result.data.pincode);
                                        $("#txtContactPerson").val(result.data.contactPersonName);
                                        $("#txtPhone").val(result.data.phone);
                                        $("#txtMobile").val(result.data.mobile);
                                        $("#txtAlternateMobile").val(result.data.mobileAlternate);
                                        $("#txtEmail").val(result.data.email);
                                        $("#txtEWBAdressLine1").val(result.data.ewbAddress1);
                                        $("#txtEWBAdressLine2").val(result.data.ewbAddress2);
                                        $("#dtRenewalDate").val(result.data.renewalDateStr);
                                        $("#txtRenewalPrice").val(result.data.renewalPrice);
                                        $("#txtSetupPrice").val(result.data.setupPrice);
                                        $("#txtOrderNumber").val(result.data.orderNumber);
                                        $('#chkActive').prop('checked',result.data.isActive);

                             } else {
                                 showError('Error', result.data); //warning,  success, error, info
                             }
                         } catch (e) {
                             unblockUI('container');
                             showError('Error', e); //warning,  success, error, info
                         }
                     },
                     function (error) {

                     });
             }
             catch (err) {
             }
         }
</script>
}